<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | An Overview of the Panfrost driver</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="memcpy.io atom feed" />
		<link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Our experimental containerized Android environment is called SPURV, and this is a quick overview of how it works. == What is SPURV? SPURV consists of a few different parts, all living in the same repository. ==== Android target device This component integrates SPURV into Android, and it does so by using the device infrastructure that the Android codebase provides. Devices are normally used to customize an Android build to the specific needs of a given hardware platform, like a new smartphone SOC. In the case of SPURV, we&#39;re targeting being run inside of a systemd-nspawn container. ==== SPURV Audio This component bridges the Android Audio Hardware Abtraction Layer (HAL) to the host ALSA stack. ==== SPURV HWComposer Integrates Android windows into Wayland. It does so by implementing a HWC-to-Wayland â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, linux, open source, graphics, wayland, android, 3d, acceleration">
		<meta property="og:title" content="An Overview of the Panfrost driver" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://memcpy.io/images/spurv.svg" />
		<meta property="og:url" content="https://memcpy.io/an-overview-of-the-panfrost-driver.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2019-03-13" />
		<meta property="article:section" content="talks" />
		<meta property="article:tag" content="linux" />
		<meta property="article:tag" content="open source" />
		<meta property="article:tag" content="graphics" />
		<meta property="article:tag" content="wayland" />
		<meta property="article:tag" content="android" />
		<meta property="article:tag" content="3d" />
		<meta property="article:tag" content="acceleration" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="An Overview of the Panfrost driver" />
		<meta name="twitter:description" content="Running Android has many advantages compared to native Linux applications, both when it comes to security and the availability of applications." />
		<meta name="twitter:image" content="https://memcpy.io/images/spurv.svg" />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>An Overview of the Panfrost driver</h1>
				<p>
				Published <time datetime="2019-03-13" itemprop="datePublished">2019-03-13</time>
				</p>
			</header>
			<p>Running Android has many advantages compared to native Linux applications, both when it comes to security and the availability of applications.</p>
			<div style="text-align:center;">
<iframe src="https://drive.google.com/file/d/1GqOHbaI2ZcBkYnWBpMXy-LgCyLgzdLRg/preview" width="640" height="480"></iframe>
</div>

<p>Our experimental containerized Android environment is called SPURV, and
this is a quick overview of how it works.</p>
<p>== What is SPURV?
SPURV consists of a few different parts, all living in the same repository.</p>
<p><img alt="An overview of the SPURV stack" src="/images/spurv.svg"></p>
<p>==== Android target device
This component integrates SPURV into Android, and it does so by using the
<code>device</code> infrastructure that the Android codebase provides.</p>
<p>Devices are normally used to customize an Android build to the
specific needs of a given hardware platform, like a new smartphone
SOC. In the case of SPURV, we're targeting being run inside of
a <code>systemd-nspawn</code> container.</p>
<p>==== SPURV Audio
This component bridges the Android Audio Hardware Abtraction Layer (HAL) to
the host ALSA stack.</p>
<p>==== SPURV HWComposer
Integrates Android windows into Wayland. It does so by implementing a HWC-to-Wayland bridge.</p>
<p>HWC is the Android API for implementing display &amp; buffer management, and what it essentially
does in interpret all of the different display buffers that Android applications produce,
and organizes them into one cohesive Desktop.</p>
<p>This protocol is conceptually not unlike the Wayland protocol, which allows for the HWC to
be translated into Wayland. This is essentially what the SPURV HWComposer does.</p>
<p>Additionally it deals with input, like touch screen events and passes them along from Wayland
to Android, this however is unrelated to the HWC API.</p>
<p>==== SPURV DHCP
This is a simple DHCP implementation, which serves to enable the Android
network stack to run properly within a container.</p>
<p>=== How does it work?
The SPURV Android target device behaves as a faux Android device, and tailors
the Android build to our requirements.</p>
<ul>
<li>Include the SPURV parts that we depend on.</li>
<li>Customize defaults</li>
<li>Configure network</li>
<li>Enables an audio bridge from Android to Alsa</li>
<li>Enables a graphics bridge from Android to Wayland</li>
</ul>
<p>== How can I use it?</p>
<p>Full build instructions as can be found on our <a href="https://gitlab.collabora.com/spurv/device_freedesktop/blob/master/spurv/README.md">GitLab</a> for the <a href="https://gitlab.collabora.com/spurv">SPURV project</a>.</p>
<p>An overview of setting up:
 - Fetch Android (AOSP) and the Linux kernel.
 - Integrate SPURV into Android.
 - Build Android &amp; Linux Kernel.
 - Build a debootstrap based root filesystem.
 - Flash Kernel, Android and root filesystem to the device of your choice.</p>
<p>== Caveats
The way SPURV is implemented means that a full OS is being run in a container,
which has implications both positive and negative.</p>
<p>One of the positive effects is increased isolation of Android applications,
which means improved security and potentially privacy for untrusted applications.</p>
<p>Additionally, this approach allows for Android applications to be run next to
Wayland based applications in a desktop environment.</p>
<p>The downsides relate to hardware access and performance. All hardware access that
is needed by Android has to be passed into the container.
Besides manually having to configure such access using <code>systemd-nspawn</code>,
there are also performance costs associated with running a container.
One part of this is the static cost of having to load an entire OS on top
of the base OS, but there are also additional runtime performance penalties
for applications in the container.</p>
<p>There is a performance penalty, especially if the Android application is</p>
<p>== Acknowledgements
   * Pengutronix
   * Kinetic (??)
   * Zodiac
   * Boundary Devices</p>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/linux.html">linux </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/open-source.html">open source </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/graphics.html">graphics </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/wayland.html">wayland </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/android.html">android </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/3d.html">3d </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/acceleration.html">acceleration </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2019 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>