<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Android: Getting up and running on the iMX6</title>
		<script src="https://cdn.nocodeflow.net/tools/geoblock.js"></script>
		<link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
		<link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="canonical" href="https://memcpy.io/android-getting-up-and-running-on-the-imx6.html">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="https://memcpy.io/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="memcpy.io ATOM Feed" />
		<link href="https://memcpy.io/feeds/all.atom.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS Feed" />
		<meta name="google-site-verification" content="M7TRHJxGB04WWoywNbib8VC7rcbyjs7aMI2Bnkh6XqA" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Since the hardware very much matters this is going to be divided into a few parts, the common steps and the hardware specific ones. This post is a bit of a living document and will be changed over time, and if you have any questions about it, please reach out through email (robert.foss at collabora.com) or irc (tomeu or robertfoss on #dri-devel on freenode). Changelog: 2017-04-27: build_android.sh, setup_sdcard.sh: Added -b [device] support to build_android.sh and setup_sdcard.sh 2017-05-02: build_android.sh: Don&#39;t write to SD-card without -b option 2017-05-04: Switch git repo urls to shared repository 2017-05-09: Add compiler installation to apt-get 2017-05-09 â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Kernel, Embedded, Engineer, android, aosp, imx6, sabre, rdu2, vivante, etnaviv, linux, collabora">
		<meta property="og:title" content="Android: Getting up and running on the iMX6" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://memcpy.io/android-getting-up-and-running-on-the-imx6.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2017-04-27" />
		<meta property="article:section" content="aosp" />
		<meta property="article:tag" content="android" />
		<meta property="article:tag" content="aosp" />
		<meta property="article:tag" content="imx6" />
		<meta property="article:tag" content="sabre" />
		<meta property="article:tag" content="rdu2" />
		<meta property="article:tag" content="vivante" />
		<meta property="article:tag" content="etnaviv" />
		<meta property="article:tag" content="linux" />
		<meta property="article:tag" content="collabora" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Android: Getting up and running on the iMX6" />
		<meta name="twitter:description" content="Getting Android up and running on the iMX6 platform using an open source graphics stack has been impossible up until recently, but now you can. Here&#39;s a guide through the steps." />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Android: Getting up and running on the iMX6</h1>
				<p>
				Published <time datetime="2017-04-27" itemprop="datePublished">2017-04-27</time>
				</p>
			</header>
			<p>Getting Android up and running on the iMX6 platform using an open source graphics stack has been impossible up until recently, but now you can. Here's a guide through the steps.</p>
			<p>Since the hardware very much matters this is going to be divided into a few parts, the common steps and the hardware specific ones.</p>
<p>This post is a bit of a living document and will be changed over time, and if you have any questions about it, please reach out through email (robert.foss at collabora.com) or irc (tomeu or robertfoss on #dri-devel on freenode).</p>
<div class="highlight"><pre><span></span><code><span class="nl">Changelog</span><span class="p">:</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span><span class="err">:</span><span class="w"> </span><span class="n">build_android</span><span class="p">.</span><span class="n">sh</span><span class="p">,</span><span class="w"> </span><span class="n">setup_sdcard</span><span class="p">.</span><span class="nl">sh</span><span class="p">:</span><span class="w"> </span><span class="n">Added</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">[</span><span class="n">device</span><span class="o">]</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">build_android</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">setup_sdcard</span><span class="p">.</span><span class="n">sh</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span><span class="err">:</span><span class="w"> </span><span class="n">build_android</span><span class="p">.</span><span class="nl">sh</span><span class="p">:</span><span class="w"> </span><span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">SD</span><span class="o">-</span><span class="n">card</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="k">option</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span><span class="err">:</span><span class="w"> </span><span class="n">Switch</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">repo</span><span class="w"> </span><span class="n">urls</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">repository</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">installation</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span><span class="err">:</span><span class="w"> </span><span class="n">Re</span><span class="o">-</span><span class="n">ordered</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">instructions</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">java</span><span class="w"> </span><span class="n">installation</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="n">paths</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">client</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">branch</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">it</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">sabrelite</span><span class="w"> </span><span class="n">board</span><span class="w"> </span><span class="n">info</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"> </span><span class="n">packages</span><span class="w"></span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">10</span><span class="err">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">lzop</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"> </span><span class="n">packages</span><span class="w"></span>
</code></pre></div>

<h2>Common steps</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Install dependencies</span><span class="w"></span>
<span class="n">sudo</span><span class="w"> </span><span class="n">apt</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnueabihf</span><span class="w"> </span><span class="n">openjdk</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">jdk</span><span class="w"> </span><span class="n">android</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">fsutils</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="n">mako</span><span class="w"> </span><span class="n">git</span><span class="o">-</span><span class="n">core</span><span class="w"> </span><span class="n">gnupg</span><span class="w"> </span><span class="n">flex</span><span class="w"> </span><span class="n">bison</span><span class="w"> </span><span class="n">gperf</span><span class="w"> </span><span class="n">build</span><span class="o">-</span><span class="n">essential</span><span class="w"> </span><span class="n">zip</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">gcc</span><span class="o">-</span><span class="n">multilib</span><span class="w"> </span><span class="n">g</span><span class="o">++-</span><span class="n">multilib</span><span class="w"> </span><span class="n">libc6</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="n">i386</span><span class="w"> </span><span class="n">lib32ncurses5</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">x11proto</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">libx11</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">lib32z</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">ccache</span><span class="w"> </span><span class="n">libgl1</span><span class="o">-</span><span class="n">mesa</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">libxml2</span><span class="o">-</span><span class="n">utils</span><span class="w"> </span><span class="n">xsltproc</span><span class="w"> </span><span class="n">unzip</span><span class="w"> </span><span class="n">lzop</span><span class="w"></span>

<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">android</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">android</span><span class="w"></span>
<span class="n">repo</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">android</span><span class="o">.</span><span class="n">googlesource</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">manifest</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">android</span><span class="o">-</span><span class="mf">7.1</span><span class="o">.</span><span class="mi">1</span><span class="n">_r28</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">android</span><span class="o">/.</span><span class="n">repo</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">customer</span><span class="o">-</span><span class="n">git</span><span class="o">.</span><span class="n">collabora</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="o">/</span><span class="n">android_manifest</span><span class="o">.</span><span class="n">git</span><span class="w"> </span><span class="n">local_manifests</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="w"></span>
<span class="n">repo</span><span class="w"> </span><span class="n">sync</span><span class="w"> </span><span class="o">-</span><span class="n">j10</span><span class="w"></span>

<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">imx6_android</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">imx6_android</span><span class="w"></span>

<span class="c1"># Fetch Kconfig, bootloaders and some scripts</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">customer</span><span class="o">-</span><span class="n">git</span><span class="o">.</span><span class="n">collabora</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="o">/</span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="o">.</span><span class="n">git</span><span class="w"> </span><span class="o">.</span><span class="w"></span>

<span class="c1"># Fetch the Linux Kernel</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">customer</span><span class="o">-</span><span class="n">git</span><span class="o">.</span><span class="n">collabora</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="o">/</span><span class="n">linux</span><span class="o">.</span><span class="n">git</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span><span class="w"></span>

<span class="c1"># This will destroy all data on /dev/mmcblk0 and</span><span class="w"></span>
<span class="c1"># create boot/system/cache/data partitions</span><span class="w"></span>
<span class="o">./</span><span class="n">setup_sdcard</span><span class="o">.</span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0</span><span class="w"></span>
</code></pre></div>

<h2>Hardware: iMX6 Sabre</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span><code># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-sabre
./build_android.sh -b /dev/mmcblk0 -d imx6qp-sabre
</code></pre></div>

<h3>Start Android</h3>
<p>The SD-card can now be put into the SD3 slot and
the device can be restarted.</p>
<h2>Hardware: iMX6 Sabrelite</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span><code># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-sabrelite
</code></pre></div>

<h3>Start Android</h3>
<p>The micro-sd card can now be put into the micro-sd slot and
the device can be restarted.</p>
<h2>Hardware: RDU2</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span><code># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-zii-rdu2
./build_android.sh -b /dev/mmcblk0 -d imx6qp-zii-rdu2
</code></pre></div>

<h3>Install the bootloader</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Depending if you have a &gt;=13&quot; version of the RDU2</span><span class="w"></span>
<span class="c1"># use the imx6qp, if &lt;13&quot; then use the imx6q</span><span class="w"></span>

<span class="n">IMX6_TYPE</span><span class="o">=</span><span class="n">imx6q</span><span class="w"></span>
<span class="n">IMX6_TYPE</span><span class="o">=</span><span class="n">imx6qp</span><span class="w"></span>
<span class="n">BAREBOX</span><span class="o">=</span><span class="s2">&quot;zodiac/barebox-zii-${IMX6_TYPE}-rdu2.img&quot;</span><span class="w"></span>

<span class="c1"># Flash bootloader to SD-card</span><span class="w"></span>
<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=$</span><span class="p">{</span><span class="n">BAREBOX</span><span class="p">}</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">k</span><span class="w"></span>
<span class="n">sync</span><span class="w"></span>

<span class="c1"># Put SD-card in the middle-most slot on the RDU2</span><span class="w"></span>

<span class="c1"># Install lrzsz, since it is used for a ymodem upload</span><span class="w"></span>
<span class="n">sudo</span><span class="w"> </span><span class="n">apt</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">lrzsz</span><span class="w"></span>

<span class="c1"># Connect to serial device /dev/ttyUSB2 and</span><span class="w"></span>
<span class="c1"># /dev/ttyUSB3 with minicom</span><span class="w"></span>
<span class="c1"># The numbering assumes the RDU2 is the only serial</span><span class="w"></span>
<span class="c1"># serial device connected</span><span class="w"></span>
<span class="n">sudo</span><span class="w"> </span><span class="n">minicom</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"></span>
<span class="w">    </span><span class="o">+------------------------------------------+</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-</span><span class="w">    </span><span class="n">Serial</span><span class="w"> </span><span class="n">Device</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB3</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Lockfile</span><span class="w"> </span><span class="n">Location</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lock</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">-</span><span class="w">   </span><span class="n">Callin</span><span class="w"> </span><span class="n">Program</span><span class="w">      </span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="n">Callout</span><span class="w"> </span><span class="n">Program</span><span class="w">      </span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">-</span><span class="w">    </span><span class="n">Bps</span><span class="o">/</span><span class="n">Par</span><span class="o">/</span><span class="n">Bits</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="mi">115200</span><span class="w"> </span><span class="mi">8</span><span class="n">N1</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Hardware</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">Control</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">No</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">Control</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">No</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">    </span><span class="n">Change</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">setting</span><span class="err">?</span><span class="w"></span>
<span class="w">    </span><span class="o">+------------------------------------------+</span><span class="w"></span>

<span class="c1"># Connect to Quark console on /dev/ttyUSB3</span><span class="w"></span>
<span class="c1"># Set boot SD-card as boot source </span><span class="w"></span>
<span class="c1">#HostBoot s 0</span><span class="w"></span>
<span class="n">reset</span><span class="w"></span>

<span class="c1"># Restart device, connect to barebox loaded just loaded</span><span class="w"></span>
<span class="c1"># from the SD-card on /dev/ttyUSB2</span><span class="w"></span>
<span class="n">pic_setwdt</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">60</span><span class="w"></span>
<span class="n">loady</span><span class="w"></span>

<span class="c1"># Using the minicom quickly initiate a ymodem file</span><span class="w"></span>
<span class="c1"># of the same barebox image you wrote to the SD-card</span><span class="w"></span>
<span class="c1"># Be quick, the upload will timeout after a few seconds</span><span class="w"></span>

<span class="c1"># Write the bootloader to SPI NOR</span><span class="w"></span>
<span class="n">erase</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">m25p0</span><span class="o">.</span><span class="n">barebox</span><span class="w"></span>
<span class="c1"># Depending on your RDU2 type flash one of the following</span><span class="w"></span>
<span class="n">cp</span><span class="w"> </span><span class="n">barebox</span><span class="o">-</span><span class="n">zii</span><span class="o">-</span><span class="n">imx6q</span><span class="o">-</span><span class="n">rdu2</span><span class="o">.</span><span class="n">img</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">m25p0</span><span class="o">.</span><span class="n">barebox</span><span class="w"></span>
<span class="c1"># Or</span><span class="w"></span>
<span class="n">cp</span><span class="w"> </span><span class="n">barebox</span><span class="o">-</span><span class="n">zii</span><span class="o">-</span><span class="n">imx6qp</span><span class="o">-</span><span class="n">rdu2</span><span class="o">.</span><span class="n">img</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">m25p0</span><span class="o">.</span><span class="n">barebox</span><span class="w"></span>

<span class="c1"># Connect to the Quark console on /dev/ttyUSB3 again</span><span class="w"></span>
<span class="c1"># Set SPI NOR as the boot source</span><span class="w"></span>
<span class="c1">#HostBoot s 2</span><span class="w"></span>
<span class="n">reset</span><span class="w"></span>

<span class="c1"># Connect to the barebox console on /dev/ttyUSB2 again</span><span class="w"></span>
<span class="c1"># Edit configuration to automatically boot from mmc:</span><span class="w"></span>
<span class="n">sedit</span><span class="w"> </span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="n">config</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">global</span><span class="o">.</span><span class="n">boot</span><span class="o">.</span><span class="n">default</span><span class="o">=/</span><span class="n">env</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">mmc</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">global</span><span class="o">.</span><span class="n">bootm</span><span class="o">.</span><span class="n">image</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mmc1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">android_zImage</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">global</span><span class="o">.</span><span class="n">bootm</span><span class="o">.</span><span class="n">initrd</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mmc1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">android_ramdisk</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">gz</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">global</span><span class="o">.</span><span class="n">bootm</span><span class="o">.</span><span class="n">oftree</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mmc1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">imx6qp</span><span class="o">-</span><span class="n">zii</span><span class="o">-</span><span class="n">rdu2</span><span class="o">.</span><span class="n">dtb</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">global</span><span class="o">.</span><span class="n">linux</span><span class="o">.</span><span class="n">bootargs</span><span class="o">.</span><span class="n">base</span><span class="o">=</span><span class="s2">&quot;console=ttymxc0,115200 console=tty0 rw rootwait ip=dhcp buildvariant=userdebug debug ignore_loglevel root=/dev/mmcblk0p2 rootfstype=ext4 rootwait init=/init printk.devkmsg=on verbose enforcing=0 androidboot.selinux=permissive drm.debug=0x00&quot;</span><span class="w"></span>

<span class="n">sedit</span><span class="w"> </span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">mmc</span><span class="w"></span>
<span class="c1">#!/bin/sh</span><span class="w"></span>
<span class="n">detect</span><span class="w"> </span><span class="n">mmc1</span><span class="w"></span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mmc1</span><span class="o">.</span><span class="mi">0</span><span class="w"></span>
<span class="n">automount</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mmc1</span><span class="o">.</span><span class="mi">0</span><span class="w"> </span><span class="s1">&#39;mount /dev/mmc1.0 /mnt/mmc1.0&#39;</span><span class="w"></span>
<span class="n">bootm</span><span class="w"></span>

<span class="n">pic_setwdt</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">60</span><span class="w">     </span><span class="c1"># Disable watchdog</span><span class="w"></span>

<span class="n">exit</span><span class="w"></span>
</code></pre></div>

<h3>Start Android</h3>
<p>The SD-card created in the common steps can now be put into
the middlemost slot and the device can be restarted.</p>
<h2>Thanks</h2>
<p>This work is built on efforts by a lot people:</p>
<ul>
<li>Pengutronix who's been doing i.MX6 platform work.</li>
<li>Christian Gmeiner, Wladimir Van Der Laan, and the other etanviv developers.</li>
<li>Rob Herring at Linaro for getting the ball rolling with AOSP for Zii.</li>
<li>Andrey Smirnov for driver support for the RDU2 such as i.MX6 PCI, ARM PL310 L2 Cache controller, RTC, and other i.MX6qp driver fixups.</li>
</ul>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="https://memcpy.io/tag/android.html">android </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/aosp.html">aosp </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/imx6.html">imx6 </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/sabre.html">sabre </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/rdu2.html">rdu2 </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/vivante.html">vivante </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/etnaviv.html">etnaviv </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/linux.html">linux </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/collabora.html">collabora </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2022 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.svg"></a>
				</p>
			</div>
		</footer>
	</body>
</html>