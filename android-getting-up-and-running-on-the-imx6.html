<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Android: Getting up and running on the iMX6</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Since the hardware very much matters this is going to be divided into a few parts, the common steps and the hardware specific ones. This post is a bit of a living document and will be changed over time, and if you have any questions about it, please reach out through email (robert.foss at collabora.com) or irc (tomeu or robertfoss on #dri-devel on freenode). Changelog: 2017-04-27: build_android.sh, setup_sdcard.sh: Added -b [device] support to build_android.sh and setup_sdcard.sh 2017-05-02: build_android.sh: Don&#39;t write to SD-card without -b option 2017-05-04: Switch git repo urls to shared repository 2017-05-09: Add compiler installation to apt-get 2017-05-09: Re-ordered some instructions 2017 â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, android, aosp, imx6, sabre, rdu2, vivante, etnaviv, linux, collabora">
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Android: Getting up and running on the iMX6</h1>
				<p>
				Published <time datetime="2017-04-27" itemprop="datePublished">2017-04-27</time>
				</p>
			</header>
			<p>Getting Android up and running on the iMX6 platform using an open source graphics stack has been impossible up until recently, but now you can. Here's a guide through the steps.</p>
			<p>Since the hardware very much matters this is going to be divided into a few parts, the common steps and the hardware specific ones.</p>
<p>This post is a bit of a living document and will be changed over time, and if you have any questions about it, please reach out through email (robert.foss at collabora.com) or irc (tomeu or robertfoss on #dri-devel on freenode).</p>
<div class="highlight"><pre><span></span><span class="n">Changelog</span><span class="o">:</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span><span class="o">:</span> <span class="n">build_android</span><span class="o">.</span><span class="na">sh</span><span class="o">,</span> <span class="n">setup_sdcard</span><span class="o">.</span><span class="na">sh</span><span class="o">:</span> <span class="n">Added</span> <span class="o">-</span><span class="n">b</span> <span class="o">[</span><span class="n">device</span><span class="o">]</span> <span class="n">support</span> <span class="n">to</span> <span class="n">build_android</span><span class="o">.</span><span class="na">sh</span> <span class="n">and</span> <span class="n">setup_sdcard</span><span class="o">.</span><span class="na">sh</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span><span class="o">:</span> <span class="n">build_android</span><span class="o">.</span><span class="na">sh</span><span class="o">:</span> <span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">write</span> <span class="n">to</span> <span class="n">SD</span><span class="o">-</span><span class="n">card</span> <span class="n">without</span> <span class="o">-</span><span class="n">b</span> <span class="n">option</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span><span class="o">:</span> <span class="n">Switch</span> <span class="n">git</span> <span class="n">repo</span> <span class="n">urls</span> <span class="n">to</span> <span class="n">shared</span> <span class="n">repository</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span><span class="o">:</span> <span class="n">Add</span> <span class="n">compiler</span> <span class="n">installation</span> <span class="n">to</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span><span class="o">:</span> <span class="n">Re</span><span class="o">-</span><span class="n">ordered</span> <span class="n">some</span> <span class="n">instructions</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span><span class="o">:</span> <span class="n">Add</span> <span class="n">java</span> <span class="n">installation</span> <span class="n">to</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="o">:</span> <span class="n">Change</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">android</span><span class="o">-</span><span class="n">etnaviv</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">client</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="o">:</span> <span class="n">Change</span> <span class="n">kernel</span> <span class="n">branch</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="o">:</span> <span class="n">Add</span> <span class="o">-</span><span class="n">d</span><span class="o">,</span> <span class="n">device</span> <span class="n">flag</span> <span class="n">and</span> <span class="n">info</span> <span class="n">about</span> <span class="n">it</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span><span class="o">:</span> <span class="n">Add</span> <span class="n">sabrelite</span> <span class="n">board</span> <span class="n">info</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span><span class="o">:</span> <span class="n">Add</span> <span class="n">more</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span> <span class="n">packages</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">10</span><span class="o">:</span> <span class="n">Add</span> <span class="n">lzop</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span> <span class="n">packages</span>
</pre></div>


<h2>Common steps</h2>
<div class="highlight"><pre><span></span># Install dependencies
sudo apt install u-boot-tools gcc-arm-linux-gnueabihf openjdk-8-jdk android-tools-fsutils python-mako git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip lzop

mkdir /opt/android
cd /opt/android
repo init -u https://android.googlesource.com/platform/manifest -b android-7.1.1_r28
cd /opt/android/.repo
git clone https://customer-git.collabora.com/git/android-etnaviv/android_manifest.git local_manifests -b android-etnaviv
repo sync -j10

mkdir /opt/imx6_android
cd /opt/imx6_android

# Fetch Kconfig, bootloaders and some scripts
git clone https://customer-git.collabora.com/git/android-etnaviv/android-etnaviv.git .

# Fetch the Linux Kernel
git clone https://customer-git.collabora.com/git/android-etnaviv/linux.git -b android-etnaviv

# This will destroy all data on /dev/mmcblk0 and
# create boot/system/cache/data partitions
./setup_sdcard.sh -b /dev/mmcblk0
</pre></div>


<h2>Hardware: iMX6 Sabre</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-sabre
./build_android.sh -b /dev/mmcblk0 -d imx6qp-sabre
</pre></div>


<h3>Start Android</h3>
<p>The SD-card can now be put into the SD3 slot and
the device can be restarted.</p>
<h2>Hardware: iMX6 Sabrelite</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-sabrelite
</pre></div>


<h3>Start Android</h3>
<p>The micro-sd card can now be put into the micro-sd slot and
the device can be restarted.</p>
<h2>Hardware: RDU2</h2>
<h3>Build Android and Linux</h3>
<div class="highlight"><pre><span></span># Build android, the kernel, and flash it onto an SD-card
# Run build_android with the correct -d flag
./build_android.sh -b /dev/mmcblk0 -d imx6q-zii-rdu2
./build_android.sh -b /dev/mmcblk0 -d imx6qp-zii-rdu2
</pre></div>


<h3>Install the bootloader</h3>
<div class="highlight"><pre><span></span># Depending if you have a &gt;=13&quot; version of the RDU2
# use the imx6qp, if <span class="nt">&lt;13</span><span class="err">&quot;</span> <span class="err">then</span> <span class="err">use</span> <span class="err">the</span> <span class="err">imx6q</span>

<span class="na">IMX6_TYPE=</span><span class="s">imx6q</span>
<span class="na">IMX6_TYPE=</span><span class="s">imx6qp</span>
<span class="na">BAREBOX=</span><span class="s">&quot;zodiac/barebox-zii-</span><span class="cp">${</span><span class="n">IMX6_TYPE</span><span class="cp">}</span><span class="s">-rdu2.img&quot;</span>

<span class="err">#</span> <span class="err">Flash</span> <span class="err">bootloader</span> <span class="err">to</span> <span class="err">SD-card</span>
<span class="err">dd</span> <span class="na">if=</span><span class="s">${BAREBOX}</span> <span class="na">of=</span><span class="s">/dev/mmcblk0</span> <span class="na">bs=</span><span class="s">1k</span>
<span class="err">sync</span>

<span class="err">#</span> <span class="err">Put</span> <span class="err">SD-card</span> <span class="err">in</span> <span class="err">the</span> <span class="err">middle-most</span> <span class="err">slot</span> <span class="err">on</span> <span class="err">the</span> <span class="err">RDU2</span>

<span class="err">#</span> <span class="err">Install</span> <span class="err">lrzsz,</span> <span class="err">since</span> <span class="err">it</span> <span class="err">is</span> <span class="err">used</span> <span class="err">for</span> <span class="err">a</span> <span class="err">ymodem</span> <span class="err">upload</span>
<span class="err">sudo</span> <span class="err">apt</span> <span class="err">install</span> <span class="err">lrzsz</span>

<span class="err">#</span> <span class="err">Connect</span> <span class="err">to</span> <span class="err">serial</span> <span class="err">device</span> <span class="err">/dev/ttyUSB2</span> <span class="err">and</span>
<span class="err">#</span> <span class="err">/dev/ttyUSB3</span> <span class="err">with</span> <span class="err">minicom</span>
<span class="err">#</span> <span class="err">The</span> <span class="err">numbering</span> <span class="err">assumes</span> <span class="err">the</span> <span class="err">RDU2</span> <span class="err">is</span> <span class="err">the</span> <span class="err">only</span> <span class="err">serial</span>
<span class="err">#</span> <span class="err">serial</span> <span class="err">device</span> <span class="err">connected</span>
<span class="err">sudo</span> <span class="err">minicom</span> <span class="err">-s</span>
    <span class="err">+------------------------------------------+</span>
    <span class="err">|</span> <span class="err">A</span> <span class="err">-</span>    <span class="err">Serial</span> <span class="err">Device</span>      <span class="err">:</span> <span class="err">/dev/ttyUSB3</span>
    <span class="err">|</span> <span class="err">B</span> <span class="err">-</span> <span class="err">Lockfile</span> <span class="err">Location</span>     <span class="err">:</span> <span class="err">/var/lock</span>
    <span class="err">|</span> <span class="err">C</span> <span class="err">-</span>   <span class="err">Callin</span> <span class="err">Program</span>      <span class="err">:</span>
    <span class="err">|</span> <span class="err">D</span> <span class="err">-</span>  <span class="err">Callout</span> <span class="err">Program</span>      <span class="err">:</span>
    <span class="err">|</span> <span class="err">E</span> <span class="err">-</span>    <span class="err">Bps/Par/Bits</span>       <span class="err">:</span> <span class="err">115200</span> <span class="err">8N1</span>
    <span class="err">|</span> <span class="err">F</span> <span class="err">-</span> <span class="err">Hardware</span> <span class="err">Flow</span> <span class="err">Control</span> <span class="err">:</span> <span class="err">No</span>
    <span class="err">|</span> <span class="err">G</span> <span class="err">-</span> <span class="err">Software</span> <span class="err">Flow</span> <span class="err">Control</span> <span class="err">:</span> <span class="err">No</span>
    <span class="err">|</span>
    <span class="err">|</span>    <span class="err">Change</span> <span class="err">which</span> <span class="err">setting?</span>
    <span class="err">+------------------------------------------+</span>

<span class="err">#</span> <span class="err">Connect</span> <span class="err">to</span> <span class="err">Quark</span> <span class="err">console</span> <span class="err">on</span> <span class="err">/dev/ttyUSB3</span>
<span class="err">#</span> <span class="err">Set</span> <span class="err">boot</span> <span class="err">SD-card</span> <span class="err">as</span> <span class="err">boot</span> <span class="err">source</span> 
<span class="err">#HostBoot</span> <span class="err">s</span> <span class="err">0</span>
<span class="err">reset</span>

<span class="err">#</span> <span class="err">Restart</span> <span class="err">device,</span> <span class="err">connect</span> <span class="err">to</span> <span class="err">barebox</span> <span class="err">loaded</span> <span class="err">just</span> <span class="err">loaded</span>
<span class="err">#</span> <span class="err">from</span> <span class="err">the</span> <span class="err">SD-card</span> <span class="err">on</span> <span class="err">/dev/ttyUSB2</span>
<span class="err">pic_setwdt</span> <span class="err">0</span> <span class="err">60</span>
<span class="err">loady</span>

<span class="err">#</span> <span class="err">Using</span> <span class="err">the</span> <span class="err">minicom</span> <span class="err">quickly</span> <span class="err">initiate</span> <span class="err">a</span> <span class="err">ymodem</span> <span class="err">file</span>
<span class="err">#</span> <span class="err">of</span> <span class="err">the</span> <span class="err">same</span> <span class="err">barebox</span> <span class="err">image</span> <span class="err">you</span> <span class="err">wrote</span> <span class="err">to</span> <span class="err">the</span> <span class="err">SD-card</span>
<span class="err">#</span> <span class="err">Be</span> <span class="err">quick,</span> <span class="err">the</span> <span class="err">upload</span> <span class="err">will</span> <span class="err">timeout</span> <span class="err">after</span> <span class="err">a</span> <span class="err">few</span> <span class="err">seconds</span>

<span class="err">#</span> <span class="err">Write</span> <span class="err">the</span> <span class="err">bootloader</span> <span class="err">to</span> <span class="err">SPI</span> <span class="err">NOR</span>
<span class="err">erase</span> <span class="err">/dev/m25p0.barebox</span>
<span class="err">#</span> <span class="err">Depending</span> <span class="err">on</span> <span class="err">your</span> <span class="err">RDU2</span> <span class="err">type</span> <span class="err">flash</span> <span class="err">one</span> <span class="err">of</span> <span class="err">the</span> <span class="err">following</span>
<span class="err">cp</span> <span class="err">barebox-zii-imx6q-rdu2.img</span> <span class="err">/dev/m25p0.barebox</span>
<span class="err">#</span> <span class="err">Or</span>
<span class="err">cp</span> <span class="err">barebox-zii-imx6qp-rdu2.img</span> <span class="err">/dev/m25p0.barebox</span>

<span class="err">#</span> <span class="err">Connect</span> <span class="err">to</span> <span class="err">the</span> <span class="err">Quark</span> <span class="err">console</span> <span class="err">on</span> <span class="err">/dev/ttyUSB3</span> <span class="err">again</span>
<span class="err">#</span> <span class="err">Set</span> <span class="err">SPI</span> <span class="err">NOR</span> <span class="err">as</span> <span class="err">the</span> <span class="err">boot</span> <span class="err">source</span>
<span class="err">#HostBoot</span> <span class="err">s</span> <span class="err">2</span>
<span class="err">reset</span>

<span class="err">#</span> <span class="err">Connect</span> <span class="err">to</span> <span class="err">the</span> <span class="err">barebox</span> <span class="err">console</span> <span class="err">on</span> <span class="err">/dev/ttyUSB2</span> <span class="err">again</span>
<span class="err">#</span> <span class="err">Edit</span> <span class="err">configuration</span> <span class="err">to</span> <span class="err">automatically</span> <span class="err">boot</span> <span class="err">from</span> <span class="err">mmc:</span>
<span class="err">sedit</span> <span class="err">/env/config</span>
<span class="err">export</span> <span class="err">global.boot.</span><span class="na">default=</span><span class="s">/env/boot/mmc</span>
<span class="err">export</span> <span class="err">global.bootm.</span><span class="na">image=</span><span class="s">/mnt/mmc1.0/android_zImage</span>
<span class="err">export</span> <span class="err">global.bootm.</span><span class="na">initrd=</span><span class="s">/mnt/mmc1.0/android_ramdisk.img.gz</span>
<span class="err">export</span> <span class="err">global.bootm.</span><span class="na">oftree=</span><span class="s">/mnt/mmc1.0/imx6qp-zii-rdu2.dtb</span>
<span class="err">export</span> <span class="err">global.linux.bootargs.</span><span class="na">base=</span><span class="s">&quot;console=ttymxc0,115200 console=tty0 rw rootwait ip=dhcp buildvariant=userdebug debug ignore_loglevel root=/dev/mmcblk0p2 rootfstype=ext4 rootwait init=/init printk.devkmsg=on verbose enforcing=0 androidboot.selinux=permissive drm.debug=0x00&quot;</span>

<span class="err">sedit</span> <span class="err">/env/boot/mmc</span>
<span class="err">#!/bin/sh</span>
<span class="err">detect</span> <span class="err">mmc1</span>
<span class="err">mkdir</span> <span class="err">-p</span> <span class="err">/mnt/mmc1.0</span>
<span class="err">automount</span> <span class="err">-d</span> <span class="err">/mnt/mmc1.0</span> <span class="err">&#39;mount</span> <span class="err">/dev/mmc1.0</span> <span class="err">/mnt/mmc1.0&#39;</span>
<span class="err">bootm</span>

<span class="err">pic_setwdt</span> <span class="err">0</span> <span class="err">60</span>     <span class="err">#</span> <span class="err">Disable</span> <span class="err">watchdog</span>

<span class="err">exit</span>
</pre></div>


<h3>Start Android</h3>
<p>The SD-card created in the common steps can now be put into
the middlemost slot and the device can be restarted.</p>
<h2>Thanks</h2>
<p>This work is built on efforts by a lot people:</p>
<ul>
<li>Pengutronix who's been doing i.MX6 platform work.</li>
<li>Christian Gmeiner, Wladimir Van Der Laan, and the other etanviv developers.</li>
<li>Rob Herring at Linaro for getting the ball rolling with AOSP for Zii.</li>
<li>Andrey Smirnov for driver support for the RDU2 such as i.MX6 PCI, ARM PL310 L2 Cache controller, RTC, and other i.MX6qp driver fixups.</li>
</ul>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/android.html">android </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/aosp.html">aosp </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/imx6.html">imx6 </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/sabre.html">sabre </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/rdu2.html">rdu2 </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/vivante.html">vivante </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/etnaviv.html">etnaviv </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/linux.html">linux </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/collabora.html">collabora </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2019 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>