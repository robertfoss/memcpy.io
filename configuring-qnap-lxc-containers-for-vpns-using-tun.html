<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Configuring QNAP LXC containers for VPNs using TUN</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="memcpy.io atom feed" />
		<link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Configuring the QNAP device The first step is to SSH into your QNAP device using the admin account. ssh admin@NAS_IP cat &gt;&gt; /share/Container/container-station-data/lib/lxc/CONTAINER_NAME/config &lt;&lt; EOF lxc.cgroup.devices.allow = c 10:200 rwm EOF Configuring the container guest The second step is open the QNAP web-ui, open the Container Station application and enter the console of your container. sed -i &#39;/exit 0/d&#39; /etc/rc.local cat &gt;&gt; /etc/rc.local &lt;&lt; EOF if ! [ -c /dev/net/tun ]; then mkdir -p /dev/net mknod -m 666 /dev/net/tun c 10 200 fi exit 0 EOF Lastly the container needs to be restarted, and then your VPN application should be able to access TUN devices and work normally.">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, qnap, container, station, lxc, lxd, vpn, tun, tap">
		<meta property="og:title" content="Configuring QNAP LXC containers for VPNs using TUN" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://memcpy.io/images/2018-06-24_lxc_config.png" />
		<meta property="og:url" content="https://memcpy.io/configuring-qnap-lxc-containers-for-vpns-using-tun.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2018-06-24" />
		<meta property="article:section" content="sysadmin" />
		<meta property="article:tag" content="qnap" />
		<meta property="article:tag" content="container" />
		<meta property="article:tag" content="station" />
		<meta property="article:tag" content="lxc" />
		<meta property="article:tag" content="lxd" />
		<meta property="article:tag" content="vpn" />
		<meta property="article:tag" content="tun" />
		<meta property="article:tag" content="tap" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Configuring QNAP LXC containers for VPNs using TUN" />
		<meta name="twitter:description" content="Setting up a QNAP NAS as a VPN client is easy, but setting its containers up for VPNs is harder." />
		<meta name="twitter:image" content="https://memcpy.io/images/2018-06-24_lxc_config.png" />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Configuring QNAP LXC containers for VPNs using TUN</h1>
				<p>
				Published <time datetime="2018-06-24" itemprop="datePublished">2018-06-24</time>
				</p>
			</header>
			<p>Setting up a QNAP NAS as a VPN client is easy, but setting its containers up for VPNs is harder.</p>
			<p><a href="/images/2018-06-24_lxc_config.png"><img alt="Alt text" src="/images/2018-06-24_lxc_config.png" title="QNAP Container Station LXC Config">
</a></p>
<h3>Configuring the QNAP device</h3>
<p>The first step is to SSH into your QNAP device using the <em>admin</em> account.</p>
<div class="highlight"><pre><span></span>ssh admin@NAS_IP
cat &gt;&gt; /share/Container/container-station-data/lib/lxc/CONTAINER_NAME/config &lt;&lt; EOF
lxc.cgroup.devices.allow = c 10:200 rwm
EOF
</pre></div>


<h3>Configuring the container guest</h3>
<p>The second step is open the QNAP web-ui, open the Container Station
application and enter the console of your container.</p>
<div class="highlight"><pre><span></span>sed -i &#39;/exit 0/d&#39; /etc/rc.local
cat &gt;&gt; /etc/rc.local &lt;&lt; EOF
if ! [ -c /dev/net/tun ]; then
    mkdir -p /dev/net
    mknod -m 666 /dev/net/tun c 10 200
fi

exit 0
EOF
</pre></div>


<p>Lastly the container needs to be restarted, and then your VPN application
should be able to access TUN devices and work normally.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/qnap.html">qnap </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/container.html">container </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/station.html">station </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/lxc.html">lxc </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/lxd.html">lxd </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/vpn.html">vpn </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/tun.html">tun </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/tap.html">tap </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2019 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>