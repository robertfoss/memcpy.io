<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>memcpy.io - acceleration</title><link href="https://memcpy.io/" rel="alternate"></link><link href="https://memcpy.io/feeds/acceleration.atom.xml" rel="self"></link><id>https://memcpy.io/</id><updated>2019-03-13T16:25:00+01:00</updated><entry><title>An Overview of the Panfrost driver</title><link href="https://memcpy.io/an-overview-of-the-panfrost-driver.html" rel="alternate"></link><published>2019-03-13T16:25:00+01:00</published><updated>2019-03-13T16:25:00+01:00</updated><author><name>Robert Foss</name></author><id>tag:memcpy.io,2019-03-13:/an-overview-of-the-panfrost-driver.html</id><summary type="html">&lt;div style="text-align:center;"&gt;
&lt;iframe src="https://drive.google.com/file/d/1GqOHbaI2ZcBkYnWBpMXy-LgCyLgzdLRg/preview" width="640" height="480"&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;Our experimental containerized Android environment is called SPURV, and
this is a quick overview of how it works.&lt;/p&gt;
&lt;p&gt;== What is SPURV?
SPURV consists of a few different parts, all living in the same repository.&lt;/p&gt;
&lt;p&gt;&lt;img alt="An overview of the SPURV stack" src="/images/spurv.svg"&gt;&lt;/p&gt;
&lt;p&gt;==== Android target device
This component integrates SPURV into Android, and it does so by using the
&lt;code&gt;device&lt;/code&gt; infrastructure that the Android codebase provides.&lt;/p&gt;
&lt;p&gt;Devices are normally used to customize an Android build to the
specific needs of a given hardware platform, like a new smartphone
SOC. In the case of SPURV, we're targeting being run inside of
a &lt;code&gt;systemd-nspawn&lt;/code&gt; container.&lt;/p&gt;
&lt;p&gt;==== SPURV Audio
This component bridges the Android Audio Hardware Abtraction Layer (HAL) to
the host ALSA stack.&lt;/p&gt;
&lt;p&gt;==== SPURV HWComposer
Integrates Android windows into Wayland. It does so by implementing a HWC-to-Wayland â€¦&lt;/p&gt;</summary><content type="html">&lt;div style="text-align:center;"&gt;
&lt;iframe src="https://drive.google.com/file/d/1GqOHbaI2ZcBkYnWBpMXy-LgCyLgzdLRg/preview" width="640" height="480"&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;Our experimental containerized Android environment is called SPURV, and
this is a quick overview of how it works.&lt;/p&gt;
&lt;p&gt;== What is SPURV?
SPURV consists of a few different parts, all living in the same repository.&lt;/p&gt;
&lt;p&gt;&lt;img alt="An overview of the SPURV stack" src="/images/spurv.svg"&gt;&lt;/p&gt;
&lt;p&gt;==== Android target device
This component integrates SPURV into Android, and it does so by using the
&lt;code&gt;device&lt;/code&gt; infrastructure that the Android codebase provides.&lt;/p&gt;
&lt;p&gt;Devices are normally used to customize an Android build to the
specific needs of a given hardware platform, like a new smartphone
SOC. In the case of SPURV, we're targeting being run inside of
a &lt;code&gt;systemd-nspawn&lt;/code&gt; container.&lt;/p&gt;
&lt;p&gt;==== SPURV Audio
This component bridges the Android Audio Hardware Abtraction Layer (HAL) to
the host ALSA stack.&lt;/p&gt;
&lt;p&gt;==== SPURV HWComposer
Integrates Android windows into Wayland. It does so by implementing a HWC-to-Wayland bridge.&lt;/p&gt;
&lt;p&gt;HWC is the Android API for implementing display &amp;amp; buffer management, and what it essentially
does in interpret all of the different display buffers that Android applications produce,
and organizes them into one cohesive Desktop.&lt;/p&gt;
&lt;p&gt;This protocol is conceptually not unlike the Wayland protocol, which allows for the HWC to
be translated into Wayland. This is essentially what the SPURV HWComposer does.&lt;/p&gt;
&lt;p&gt;Additionally it deals with input, like touch screen events and passes them along from Wayland
to Android, this however is unrelated to the HWC API.&lt;/p&gt;
&lt;p&gt;==== SPURV DHCP
This is a simple DHCP implementation, which serves to enable the Android
network stack to run properly within a container.&lt;/p&gt;
&lt;p&gt;=== How does it work?
The SPURV Android target device behaves as a faux Android device, and tailors
the Android build to our requirements.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Include the SPURV parts that we depend on.&lt;/li&gt;
&lt;li&gt;Customize defaults&lt;/li&gt;
&lt;li&gt;Configure network&lt;/li&gt;
&lt;li&gt;Enables an audio bridge from Android to Alsa&lt;/li&gt;
&lt;li&gt;Enables a graphics bridge from Android to Wayland&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;== How can I use it?&lt;/p&gt;
&lt;p&gt;Full build instructions as can be found on our &lt;a href="https://gitlab.collabora.com/spurv/device_freedesktop/blob/master/spurv/README.md"&gt;GitLab&lt;/a&gt; for the &lt;a href="https://gitlab.collabora.com/spurv"&gt;SPURV project&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;An overview of setting up:
 - Fetch Android (AOSP) and the Linux kernel.
 - Integrate SPURV into Android.
 - Build Android &amp;amp; Linux Kernel.
 - Build a debootstrap based root filesystem.
 - Flash Kernel, Android and root filesystem to the device of your choice.&lt;/p&gt;
&lt;p&gt;== Caveats
The way SPURV is implemented means that a full OS is being run in a container,
which has implications both positive and negative.&lt;/p&gt;
&lt;p&gt;One of the positive effects is increased isolation of Android applications,
which means improved security and potentially privacy for untrusted applications.&lt;/p&gt;
&lt;p&gt;Additionally, this approach allows for Android applications to be run next to
Wayland based applications in a desktop environment.&lt;/p&gt;
&lt;p&gt;The downsides relate to hardware access and performance. All hardware access that
is needed by Android has to be passed into the container.
Besides manually having to configure such access using &lt;code&gt;systemd-nspawn&lt;/code&gt;,
there are also performance costs associated with running a container.
One part of this is the static cost of having to load an entire OS on top
of the base OS, but there are also additional runtime performance penalties
for applications in the container.&lt;/p&gt;
&lt;p&gt;There is a performance penalty, especially if the Android application is&lt;/p&gt;
&lt;p&gt;== Acknowledgements
   * Pengutronix
   * Kinetic (??)
   * Zodiac
   * Boundary Devices&lt;/p&gt;
&lt;p&gt;This post has been a part of work undertaken by my employer &lt;a href="http://www.collabora.com"&gt;Collabora&lt;/a&gt;.&lt;/p&gt;</content><category term="linux"></category><category term="open source"></category><category term="graphics"></category><category term="wayland"></category><category term="android"></category><category term="3d"></category><category term="acceleration"></category></entry></feed>