<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>memcpy.io - corruption</title><link href="https://memcpy.io/" rel="alternate"></link><link href="https://memcpy.io/feeds/corruption.atom.xml" rel="self"></link><id>https://memcpy.io/</id><updated>2018-02-13T20:20:00+01:00</updated><entry><title>Fixing .zsh_history corruption</title><link href="https://memcpy.io/fixing-zsh_history-corruption.html" rel="alternate"></link><published>2018-02-13T20:20:00+01:00</published><updated>2018-02-13T20:20:00+01:00</updated><author><name>Robert Foss</name></author><id>tag:memcpy.io,2018-02-13:/fixing-zsh_history-corruption.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;zsh&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;corrupt&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="sr"&gt;/home/$USER/&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;zsh_history&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Most zsh user will have seen the above line at one time or another.&lt;br&gt;
And it means that re-using your shell history is no longer possible.&lt;/p&gt;
&lt;p&gt;Maybe some of it can be recovered, but more than likely some has been lost.
And even if nothing important has been lost, you probably don't want to spend any time dealing with this.&lt;/p&gt;
&lt;h2&gt;Make zsh maintain a backup&lt;/h2&gt;
&lt;p&gt;Run this snippet in the terminal of your choice.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;lt;&amp;lt;EOT&amp;gt;&amp;gt; ~/.zshrc

# Backup and restore ZSH history
strings ~/.zsh_history | sed &amp;#39;:a;N;$!ba;s/\\\\\n//g&amp;#39; | sort | uniq -u &amp;gt; ~/.zsh_history.backup
cat ~/.zsh_history ~/.zsh_history.backup | sed &amp;#39;:a;N;$!ba;s/\\\\\n//g&amp;#39;| sort | uniq &amp;gt; ~/.zsh_history.backup

EOT
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;What does this actually do?&lt;/h3&gt;
&lt;p&gt;The â€¦&lt;/p&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;zsh&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;corrupt&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="sr"&gt;/home/$USER/&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;zsh_history&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Most zsh user will have seen the above line at one time or another.&lt;br&gt;
And it means that re-using your shell history is no longer possible.&lt;/p&gt;
&lt;p&gt;Maybe some of it can be recovered, but more than likely some has been lost.
And even if nothing important has been lost, you probably don't want to spend any time dealing with this.&lt;/p&gt;
&lt;h2&gt;Make zsh maintain a backup&lt;/h2&gt;
&lt;p&gt;Run this snippet in the terminal of your choice.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;lt;&amp;lt;EOT&amp;gt;&amp;gt; ~/.zshrc

# Backup and restore ZSH history
strings ~/.zsh_history | sed &amp;#39;:a;N;$!ba;s/\\\\\n//g&amp;#39; | sort | uniq -u &amp;gt; ~/.zsh_history.backup
cat ~/.zsh_history ~/.zsh_history.backup | sed &amp;#39;:a;N;$!ba;s/\\\\\n//g&amp;#39;| sort | uniq &amp;gt; ~/.zsh_history.backup

EOT
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;What does this actually do?&lt;/h3&gt;
&lt;p&gt;The snippet runs on every terminal open and copies your current .zsh_history into a backup file, creatively called .zsh_history.backup.&lt;br&gt;
The backup file is then cleaned up and deduplicated deduplicated lines are removed. Lastly the backup is appended to your actual .zsh_history file.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Hopefully this guide will have helped you avoid one of the more annoying aspects of zsh.&lt;/p&gt;</content><category term="linux"></category><category term="shell"></category><category term="zsh"></category><category term="history"></category><category term=".zsh_history"></category><category term="corruption"></category><category term="fix"></category><category term="how"></category><category term="to"></category><category term="how-to"></category></entry></feed>