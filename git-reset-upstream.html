<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | git reset upstream</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="canonical" href="https://www.collabora.com/news-and-blog/blog/2018/08/27/quick-hack-git-reset-upstream/">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="memcpy.io atom feed" />
		<link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="robertfoss@xps9570 ~/work/libdrm $ git ru remote: Counting objects: 234, done. remote: Compressing objects: 100% (233/233), done. remote: Total 234 (delta 177), reused 0 (delta 0) Receiving objects: 100% (234/234), 53.20 KiB | 939.00 KiB/s, done. Resolving deltas: 100% (177/177), completed with 36 local objects. From git://anongit.freedesktop.org/mesa/drm cb592ac8166e..bcb9d976cd91 master -&gt; upstream/master * [new tag] libdrm-2.4.93 -&gt; libdrm-2.4.93 * [new tag] libdrm-2.4.94 -&gt; libdrm-2.4.94 The idea here is that we by issuing a single short command can fetch the latest master branch from the upstream repository of the codebase we&#39;re working on and set our local master branch to point to the most recent upstream/master one …">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, collabora, git, reset, upstream, pull, synchronize">
		<meta property="og:title" content="git reset upstream" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://memcpy.io/git-reset-upstream.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2018-08-24" />
		<meta property="article:section" content="git" />
		<meta property="article:tag" content="collabora" />
		<meta property="article:tag" content="git" />
		<meta property="article:tag" content="reset" />
		<meta property="article:tag" content="upstream" />
		<meta property="article:tag" content="pull" />
		<meta property="article:tag" content="synchronize" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="git reset upstream" />
		<meta name="twitter:description" content="Working with a git based project that has a defacto upstream repository means that you perioducally want to fetch the canonical master branch. This can be simplified with a .gitconfig alias." />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>git reset upstream</h1>
				<p>
				Published <time datetime="2018-08-24" itemprop="datePublished">2018-08-24</time>
				</p>
			</header>
			<p>Working with a git based project that has a defacto upstream repository means that you perioducally want to fetch the canonical master branch. This can be simplified with a .gitconfig alias.</p>
			<div class="highlight"><pre><span></span><span class="n">robertfoss</span><span class="p">@</span><span class="n">xps9570</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">libdrm</span> <span class="err">$</span> <span class="n">git</span> <span class="n">ru</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">234</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">233</span><span class="o">/</span><span class="mi">233</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">234</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">177</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">0</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Receiving</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">234</span><span class="o">/</span><span class="mi">234</span><span class="p">),</span> <span class="mf">53.20</span> <span class="n">KiB</span> <span class="o">|</span> <span class="mf">939.00</span> <span class="n">KiB</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Resolving</span> <span class="nl">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">177</span><span class="o">/</span><span class="mi">177</span><span class="p">),</span> <span class="n">completed</span> <span class="n">with</span> <span class="mi">36</span> <span class="n">local</span> <span class="n">objects</span><span class="p">.</span>
<span class="n">From</span> <span class="nl">git</span><span class="p">:</span><span class="c1">//anongit.freedesktop.org/mesa/drm</span>
   <span class="n">cb592ac8166e</span><span class="p">..</span><span class="n">bcb9d976cd91</span>  <span class="n">master</span>     <span class="o">-&gt;</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span>
 <span class="o">*</span> <span class="p">[</span><span class="n">new</span> <span class="n">tag</span><span class="p">]</span>                   <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.93</span> <span class="o">-&gt;</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.93</span>
 <span class="o">*</span> <span class="p">[</span><span class="n">new</span> <span class="n">tag</span><span class="p">]</span>                   <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.94</span> <span class="o">-&gt;</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.94</span>
</pre></div>


<p>The idea here is that we by issuing a single short command can fetch the
latest master branch from the upstream repository of the codebase we're
working on and set our local master branch to point to the most recent
upstream/master one.</p>
<p>This works by looking for a remote called <code>upstream</code> (or falling back to
<code>origin</code> if it isn't found). And resetting the local master branch to point at
the upstream/master branch.</p>
<h2>~/.gitconfig</h2>
<p>Add this snippet under the <code>[alias]</code> section of your <code>~/.gitconfig</code> file.</p>
<div class="highlight"><pre><span></span><span class="k">[alias]</span>
    <span class="na">ru</span> <span class="o">=</span> <span class="s">&quot;!f() { \</span>
<span class="s">        REMOTES=$(git remote); \</span>
<span class="s">        REMOTE=\&quot;origin\&quot;; \</span>
<span class="s">        case \&quot;$REMOTES\&quot; in \</span>
<span class="s">            *upstream*) \</span>
<span class="s">                REMOTE=\&quot;upstream\&quot;; \</span>
<span class="s">                ;; \</span>
<span class="s">        esac; \</span>
<span class="s">        git fetch $REMOTE; \</span>
<span class="s">        git update-ref refs/heads/master refs/remotes/$REMOTE/master; \</span>
<span class="s">        git checkout master &gt;/dev/null 2&gt;&amp;1; \</span>
<span class="s">        git reset --hard $REMOTE/master &gt;/dev/null 2&gt;&amp;1; \</span>
<span class="s">        git checkout - &gt;/dev/null 2&gt;&amp;1; \</span>
<span class="s">    }; f</span>
</pre></div>


<p>If you have a closer look, you'll notice that the <code>upstream</code> remote is used if
has been added, otherwise the <code>origin</code> remote is used. This selection is
done using git running a shell script.</p>
<h2>Example</h2>
<p>This is what <code>git ru</code> might look like when used.</p>
<div class="highlight"><pre><span></span><span class="n">robertfoss</span><span class="p">@</span><span class="n">xps9570</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">libdrm</span> <span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>
<span class="n">origin</span>  <span class="n">git</span><span class="p">@</span><span class="n">gitlab</span><span class="p">.</span><span class="n">collabora</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span><span class="n">robertfoss</span><span class="o">/</span><span class="n">libdrm</span><span class="p">.</span><span class="n">git</span> <span class="p">(</span><span class="n">fetch</span><span class="p">)</span>
<span class="n">origin</span>  <span class="n">git</span><span class="p">@</span><span class="n">gitlab</span><span class="p">.</span><span class="n">collabora</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span><span class="n">robertfoss</span><span class="o">/</span><span class="n">libdrm</span><span class="p">.</span><span class="n">git</span> <span class="p">(</span><span class="n">push</span><span class="p">)</span>
<span class="n">upstream</span>    <span class="nl">git</span><span class="p">:</span><span class="c1">//anongit.freedesktop.org/mesa/drm (fetch)</span>
<span class="n">upstream</span>    <span class="nl">git</span><span class="p">:</span><span class="c1">//anongit.freedesktop.org/mesa/drm (push)</span>

<span class="n">robertfoss</span><span class="p">@</span><span class="n">xps9570</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">libdrm</span> <span class="err">$</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">pretty</span><span class="o">=</span><span class="n">log</span> <span class="o">--</span><span class="n">abbrev</span><span class="o">-</span><span class="n">commit</span>
<span class="n">cb592ac8166e</span> <span class="o">-</span> <span class="p">(</span><span class="n">HEAD</span> <span class="o">-&gt;</span> <span class="n">master</span><span class="p">,</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span><span class="p">,</span> <span class="nl">tag</span><span class="p">:</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.92</span><span class="p">)</span> <span class="n">bump</span> <span class="n">version</span> <span class="k">for</span> <span class="k">release</span> <span class="p">(</span><span class="mi">4</span> <span class="n">months</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Rob</span> <span class="n">Clark</span><span class="o">&gt;</span>
<span class="n">c5a656818492</span> <span class="o">-</span> <span class="nl">freedreno</span><span class="p">:</span> <span class="n">add</span> <span class="n">fd_pipe</span> <span class="n">refcounting</span> <span class="p">(</span><span class="mi">4</span> <span class="n">months</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Rob</span> <span class="n">Clark</span><span class="o">&gt;</span>
<span class="mi">1</span><span class="n">ac3ecde2f2c</span> <span class="o">-</span> <span class="nl">intel</span><span class="p">:</span> <span class="n">add</span> <span class="n">support</span> <span class="k">for</span> <span class="n">ICL</span> <span class="mi">11</span> <span class="p">(</span><span class="mi">4</span> <span class="n">months</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Paulo</span> <span class="n">Zanoni</span><span class="o">&gt;</span>
<span class="n">bc9c789073c8</span> <span class="o">-</span> <span class="nl">amdgpu</span><span class="p">:</span> <span class="n">Deinitialize</span> <span class="n">vamgr_high</span><span class="p">{,</span><span class="n">_32</span><span class="p">}</span> <span class="p">(</span><span class="mi">4</span> <span class="n">months</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Michel</span> <span class="n">D</span><span class="err">ä</span><span class="n">nzer</span><span class="o">&gt;</span>
<span class="p">[</span><span class="n">snip</span><span class="p">]</span>

<span class="n">robertfoss</span><span class="p">@</span><span class="n">xps9570</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">libdrm</span> <span class="err">$</span> <span class="n">git</span> <span class="n">ru</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">234</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">233</span><span class="o">/</span><span class="mi">233</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">234</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">177</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">0</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Receiving</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">234</span><span class="o">/</span><span class="mi">234</span><span class="p">),</span> <span class="mf">53.20</span> <span class="n">KiB</span> <span class="o">|</span> <span class="mf">939.00</span> <span class="n">KiB</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Resolving</span> <span class="nl">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">177</span><span class="o">/</span><span class="mi">177</span><span class="p">),</span> <span class="n">completed</span> <span class="n">with</span> <span class="mi">36</span> <span class="n">local</span> <span class="n">objects</span><span class="p">.</span>
<span class="n">From</span> <span class="nl">git</span><span class="p">:</span><span class="c1">//anongit.freedesktop.org/mesa/drm</span>
   <span class="n">cb592ac8166e</span><span class="p">..</span><span class="n">bcb9d976cd91</span>  <span class="n">master</span>     <span class="o">-&gt;</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span>
 <span class="o">*</span> <span class="p">[</span><span class="n">new</span> <span class="n">tag</span><span class="p">]</span>                   <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.93</span> <span class="o">-&gt;</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.93</span>
 <span class="o">*</span> <span class="p">[</span><span class="n">new</span> <span class="n">tag</span><span class="p">]</span>                   <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.94</span> <span class="o">-&gt;</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.94</span>

<span class="n">robertfoss</span><span class="p">@</span><span class="n">xps9570</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">libdrm</span> <span class="err">$</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">pretty</span><span class="o">=</span><span class="n">log</span> <span class="o">--</span><span class="n">abbrev</span><span class="o">-</span><span class="n">commit</span>
<span class="n">cb9d976cd91</span> <span class="o">-</span> <span class="p">(</span><span class="n">HEAD</span> <span class="o">-&gt;</span> <span class="n">master</span><span class="p">,</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span><span class="p">)</span> <span class="nl">xf86drm</span><span class="p">:</span> <span class="n">fallback</span> <span class="n">to</span> <span class="n">normal</span> <span class="n">path</span> <span class="n">when</span> <span class="n">realpath</span> <span class="n">fails</span> <span class="p">(</span><span class="mi">4</span> <span class="n">hours</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Emil</span> <span class="n">Velikov</span><span class="o">&gt;</span>
<span class="mi">8389</span><span class="n">c5454804</span> <span class="o">-</span> <span class="p">(</span><span class="nl">tag</span><span class="p">:</span> <span class="n">libdrm</span><span class="o">-</span><span class="mf">2.4.94</span><span class="p">)</span> <span class="n">Bump</span> <span class="n">to</span> <span class="n">version</span> <span class="mf">2.4.94</span> <span class="p">(</span><span class="mi">19</span> <span class="n">hours</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Kristian</span> <span class="n">H</span><span class="p">.</span> <span class="n">Kristensen</span><span class="o">&gt;</span>
<span class="n">f0c642e8df41</span> <span class="o">-</span> <span class="nl">libdrm</span><span class="p">:</span> <span class="n">add</span> <span class="n">msm</span> <span class="n">drm</span> <span class="n">uapi</span> <span class="n">header</span> <span class="p">(</span><span class="mi">25</span> <span class="n">hours</span> <span class="n">ago</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">Tanmay</span> <span class="n">Shah</span><span class="o">&gt;</span>
<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
</pre></div>


<h2>Thanks</h2>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
<p>And thanks <a href="https://twitter.com/widawsky">@widawsky</a> for pointing out some
improvements.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/collabora.html">collabora </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/git.html">git </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/reset.html">reset </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/upstream.html">upstream </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/pull.html">pull </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/synchronize.html">synchronize </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2019 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>