<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="./theme/css/style.css">
	<!--<link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">-->
	<!--<script src="/theme/js/less.js" type="text/javascript"></script>-->
	<link rel="stylesheet" type="text/css" href="./theme/css/pygments.css">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link rel="icon" type="image/png" href="favicon.png" />

	<link href="http://memcpy.io/" type="application/atom+xml" rel="alternate" title="memcpy.io ATOM Feed" />

    <meta property="og:title" content="Linux kernel development shell scripts" />
    <meta property="og:type" content="article" />
    <meta property="og:image" content="http://memcpy.io/images/2016-07-26_linux_development_helper_script.png" />
    <meta property="og:url" content="http://memcpy.io/linux-kernel-development-shell-scripts.html" />
    <meta property="og:description" content="While upstreaming kernel patches scripts/checkpatch.pl and scripts/get_maintainer.pl often come in handy. But to me the interface they provide is slightly bulky and rely on using patch files instead of git commits, which to me is a bit inconvenient. These scripts are all meant to be included in .bashrc or .zshrc scripts/checkpatch.pl helper 1 2 3 4 5 6 7 8 9 10 11#!/bin/bash function checkpatch { if [ -z ${1+x} ]; then exec git diff | scripts/checkpatch.pl --no-signoff -q - elif [[ $1 == *&#34;cache&#34;* ]]; then exec git diff --cached | scripts/checkpatch.pl --no-signoff -q - else NUM_COMMITS=$1 exec git diff HEAD~$NUM_COMMITS..HEAD | scripts/checkpatch.pl --no-signoff -q - fi } The checkpatch script simple wraps the patch creation process and allows ..." />
    <meta property="og:locale" content="" />
    <meta property="og:site_name" content="memcpy.io" />
    <meta property="article:published_time" content="2016-06-03" />
    <meta property="article:section" content="kernel" />
    <meta property="article:tag" content="linux" />
    <meta property="article:tag" content="kernel" />
    <meta property="article:tag" content="script" />

	<title>memcpy.io</title>
	<meta charset="utf-8" />
</head>
<body>
	<section id="sidebar">
		<div id="menu">
			<a href="/">
				<img type="image/png" src="./logo.png" width="155">
			</a>

			<h2>Projects, hacks and engineering</h2>
			<ul>
					<li><a href="about-me.html">About me</a></li>
					<li><a href="contracting.html">Contracting</a></li>
					<li><a href="https://github.com/robertfoss">GitHub</a></li>
					<li><a href="archives.html">Previous posts</a></li>
			</ul>
		</div>
	</section>

	<section id="posts">
	<article class="single">
		<h1 id="title">
			<a href="./linux-kernel-development-shell-scripts.html" rel="bookmark"
				title="Permalink to Linux kernel development shell scripts">Linux kernel development shell scripts</a>
		</h1>
		<abbr class="published" title="2016-06-03T10:32:00+02:00">Fri 03 June 2016</abbr>
		<p><img alt="Alt text" src="images/2016-07-26_linux_development_helper_script.png" title="Terminal screenshot of scripts in use" /></p>
<p>While upstreaming kernel patches scripts/checkpatch.pl and scripts/get_maintainer.pl
often come in handy.
But to me the interface they provide is slightly bulky and rely
on using patch files instead of git commits, which to me is a bit inconvenient.</p>
<p>These scripts are all meant to be included in <strong>.bashrc</strong> or <strong>.zshrc</strong></p>
<h2>scripts/checkpatch.pl helper</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="ch">#!/bin/bash</span>
<span class="k">function</span> checkpatch <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> -z <span class="si">${</span><span class="nv">1</span><span class="p">+x</span><span class="si">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">exec</span> git diff <span class="p">|</span> scripts/checkpatch.pl --no-signoff -q -
  <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> *<span class="s2">&quot;cache&quot;</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">exec</span> git diff --cached <span class="p">|</span> scripts/checkpatch.pl --no-signoff -q -
  <span class="k">else</span>
    <span class="nv">NUM_COMMITS</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">exec</span> git diff HEAD~$NUM_COMMITS..HEAD <span class="p">|</span> scripts/checkpatch.pl --no-signoff -q -
  <span class="k">fi</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>The checkpatch script simple wraps the patch creation process and allows you to
right away specify which </p>
<h4>Example</h4>
<div class="highlight"><pre>~/work/linux $ checkpatch 15
WARNING: ENOSYS means &#39;invalid syscall nr&#39; and nothing else
#349: FILE: drivers/tty/serial/sh-sci.c:3026:
+   if (IS_ERR(sciport-&gt;gpios) &amp;&amp; PTR_ERR(sciport-&gt;gpios) != -ENOSYS)

total: 0 errors, 1 warnings, 385 lines checked
</pre></div>


<p>In this example the 15 last commits are checked against scripts/checkpatch.pl
for correctness.</p>
<h2>scripts/get_mainteiner.pl helper</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="ch">#!/bin/bash</span>
<span class="k">function</span> get_maintainer <span class="o">{</span>
  <span class="nv">NUM_COMMITS</span><span class="o">=</span><span class="nv">$1</span>

  <span class="nv">MAINTAINERS</span><span class="o">=</span><span class="k">$(</span>git format-patch HEAD~$NUM_COMMITS..HEAD --stdout <span class="p">|</span> scripts/get_maintainer.pl<span class="k">)</span>

  <span class="c1"># Remove extraneous stats</span>
  <span class="nv">MAINTAINERS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;</span>$<span class="s2">MAINTAINERS&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/(.*//g&#39;</span><span class="k">)</span>

  <span class="c1"># Remove names from email addresses</span>
  <span class="nv">MAINTAINERS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;</span>$<span class="s2">MAINTAINERS&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/.*&lt;//g&#39;</span><span class="k">)</span>

  <span class="c1"># Remove left over character</span>
  <span class="nv">MAINTAINERS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;</span>$<span class="s2">MAINTAINERS&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/&gt;//g&#39;</span><span class="k">)</span>

  <span class="nb">echo</span> <span class="s2">&quot;</span>$<span class="s2">MAINTAINERS&quot;</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> email<span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;--to=</span><span class="si">${</span><span class="nv">email</span><span class="si">}</span><span class="s2">  &quot;</span><span class="p">;</span>
  <span class="k">done</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h4>Example</h4>
<div class="highlight"><pre>~/work/linux $ get_maintainer 1
--to=gregkh@linuxfoundation.org  --to=jslaby@suse.com  --to=linux-serial@vger.kernel.org  --to=linux-kernel@vger.kernel.org

~/work/linux $ git send-email -1 $(get_maintainer 1)
</pre></div>

		<div id="article_meta">
				Category:
					<a href="./category/kernel.html">kernel</a>
				<br />Tags:
					<a href="./tag/linux.html">linux</a>
					<a href="./tag/kernel.html">kernel</a>
					<a href="./tag/script.html">script</a>
		</div>
	</article>

	<footer>
		<a href="./" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
	</footer>


	</section>

</body>
</html>