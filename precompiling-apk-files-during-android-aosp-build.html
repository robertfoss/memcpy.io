<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Precompiling APK files during Android AOSP build</title>
		<script src="https://cdn.nocodeflow.net/tools/geoblock.js"></script>
		<link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
		<link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="canonical" href="https://memcpy.io/precompiling-apk-files-during-android-aosp-build.html">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="https://memcpy.io/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="memcpy.io ATOM Feed" />
		<link href="https://memcpy.io/feeds/all.atom.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS Feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Enable precompilation cd /opt/aosp_checkout/ find . -name BoardConfig.mk ./device/huawei/angler/BoardConfig.mk ./device/generic/mini-emulator-x86/BoardConfig.mk ./device/generic/arm64/BoardConfig.mk ./device/generic/mini-emulator-x86_64/BoardConfig.mk ./device/generic/mini-emulator-armv7-a-neon/BoardConfig.mk ./device/generic/mips/BoardConfig.mk ./device/generic/mips64/BoardConfig.mk ./device/generic/x86_64/BoardConfig.mk ./device/generic/mini-emulator-arm64/BoardConfig.mk ./device/generic/mini-emulator-mips/BoardConfig.mk ./device/generic/x86/BoardConfig.mk ./device/generic/armv7-a-neon/BoardConfig.mk ./device/generic/mini-emulator-mips64/BoardConfig.mk ./device/lge/bullhead/BoardConfig.mk ./device/linaro/generic/linaro_x86_64_only/BoardConfig.mk ./device/linaro/generic/linaro_arm64/BoardConfig.mk ./device/linaro/generic/linaro_arm64_only/BoardConfig.mk ./device/linaro/generic â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Kernel, Embedded, Engineer, aosp, apk, dex2oat, android, collabora">
		<meta property="og:title" content="Precompiling APK files during Android AOSP build" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://memcpy.io/precompiling-apk-files-during-android-aosp-build.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2017-02-22" />
		<meta property="article:section" content="android" />
		<meta property="article:tag" content="aosp" />
		<meta property="article:tag" content="apk" />
		<meta property="article:tag" content="dex2oat" />
		<meta property="article:tag" content="android" />
		<meta property="article:tag" content="collabora" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Precompiling APK files during Android AOSP build" />
		<meta name="twitter:description" content="By precompiling APK files during AOSP build a few minutes can be shaved off of the development iteration time on most commonly found Android hardware." />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Precompiling APK files during Android AOSP build</h1>
				<p>
				Published <time datetime="2017-02-22" itemprop="datePublished">2017-02-22</time>
				</p>
			</header>
			<p>By precompiling APK files during AOSP build a few minutes can be shaved off of the development iteration time on most commonly found Android hardware.</p>
			<h2>Enable precompilation</h2>
<div class="highlight"><pre><span></span><code><span class="nv">cd</span><span class="w"> </span><span class="o">/</span><span class="nv">opt</span><span class="o">/</span><span class="nv">aosp_checkout</span><span class="o">/</span><span class="w"></span>

<span class="nv">find</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">huawei</span><span class="o">/</span><span class="nv">angler</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">x86</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">arm64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">x86_64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">armv7</span><span class="o">-</span><span class="nv">a</span><span class="o">-</span><span class="nv">neon</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mips</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mips64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">x86_64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">arm64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">mips</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">x86</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">armv7</span><span class="o">-</span><span class="nv">a</span><span class="o">-</span><span class="nv">neon</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">mini</span><span class="o">-</span><span class="nv">emulator</span><span class="o">-</span><span class="nv">mips64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">lge</span><span class="o">/</span><span class="nv">bullhead</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">linaro_x86_64_only</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">linaro_arm64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">linaro_arm64_only</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">linaro_x86_64</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="nv">linaro_arm</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>
<span class="o">./</span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">hikey</span><span class="o">/</span><span class="nv">hikey</span><span class="o">/</span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="nv">Edit</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">build</span><span class="w"></span>
<span class="nv">cd</span><span class="w"> </span><span class="nv">device</span><span class="o">/</span><span class="nv">linaro</span><span class="o">/</span><span class="nv">generic</span><span class="o">/</span><span class="w"></span>
<span class="nv">nano</span><span class="w"> </span><span class="nv">BoardConfig</span><span class="o">.</span><span class="nv">mk</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="nv">Add</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="nv">option</span><span class="w"></span>
<span class="nv">WITH_DEXPREOPT</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="nv">Propagate</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">settings</span><span class="w"></span>
<span class="nv">make</span><span class="w"> </span><span class="nv">defconfig</span><span class="w"></span>
<span class="nv">make</span><span class="w"> </span><span class="nv">all</span><span class="w"></span>
</code></pre></div>

<h2>Increase system partition size</h2>
<p>Depending on the previous system partition size and how many APKs that are built, you may need to increase the system partition size.</p>
<div class="highlight"><pre><span></span><code><span class="n">nano</span><span class="w"> </span><span class="n">configs</span><span class="o">/</span><span class="n">defconfig</span><span class="w"></span>

<span class="c1"># Change the below variable to something big enough to house all of you binaries</span><span class="w"></span>
<span class="n">CONFIG_BOARD_SYSTEMIMAGE_PARTITION_SIZE</span><span class="o">=</span><span class="mi">1100000000</span><span class="w"></span>

<span class="c1"># Propagate the new settings</span><span class="w"></span>
<span class="n">make</span><span class="w"> </span><span class="n">defconfig</span><span class="w"></span>
<span class="n">make</span><span class="w"> </span><span class="n">all</span><span class="w"></span>
</code></pre></div>

<h2>Thanks</h2>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="https://memcpy.io/tag/aosp.html">aosp </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/apk.html">apk </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/dex2oat.html">dex2oat </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/android.html">android </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/collabora.html">collabora </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2022 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.svg"></a>
				</p>
			</div>
		</footer>
	</body>
</html>