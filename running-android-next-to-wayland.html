<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Running Android next to Wayland</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="memcpy.io atom feed" />
		<link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Running Android has some advantages compared to native Linux applications, for example with regard to the availability of applications and application developers. For current non-Android systems, this work enables a path forward to running Android applications in the same graphical environment as traditional non-Android applications are run. Our experimental containerized Android environment is called SPURV, and this is a quick overview of how it works. What is SPURV? SPURV consists of a few different parts, all living in the same repository. Android target device This component integrates SPURV into Android, and it does so by using the device infrastructure that the Android codebase provides. Devices are normally used to customize an Android build to the specific needs of a given hardware platform, like a new â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, linux, open source, graphics, wayland, android, 3d, acceleration">
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Running Android next to Wayland</h1>
				<p>
				Published <time datetime="2019-04-01" itemprop="datePublished">2019-04-01</time>
				</p>
			</header>
			<p>It's now possible run Android applications in the same graphical environment as regular Wayland Linux applications with full 3D acceleration.</p>
			<p>Running Android has some advantages compared to native Linux applications,
for example with regard to the availability of applications and application
developers.</p>
<p>For current non-Android systems, this work enables a path forward to running
Android applications in the same graphical environment as traditional non-Android
applications are run.</p>
<div style#"text-align:center;">
<iframe width="830" height="460" src="https://www.youtube.com/embed/594fIHWQSj4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<p>Our experimental containerized Android environment is called SPURV, and
this is a quick overview of how it works.</p>
<h2>What is SPURV?</h2>
<p>SPURV consists of a few different parts, all living in the same repository.</p>
<p><img alt="An overview of the SPURV stack" src="/images/2019_spurv.svg"></p>
<h3>Android target device</h3>
<p>This component integrates SPURV into Android, and it does so by using the
<code>device</code> infrastructure that the Android codebase provides.</p>
<p>Devices are normally used to customize an Android build to the
specific needs of a given hardware platform, like a new smartphone
SOC. In the case of SPURV, we're targeting being run inside of
a <code>systemd-nspawn</code> container.</p>
<h3>SPURV Audio</h3>
<p>This component bridges the Android Audio Hardware Abtraction Layer (HAL) to
the host ALSA stack.</p>
<h3>SPURV HWComposer</h3>
<p>Integrates Android windows into Wayland. It does so by implementing a HWC-to-Wayland bridge.</p>
<p>HWC is the Android API for implementing display &amp; buffer management, and what it essentiallyW
does in interpret all of the different display buffers that Android applications produce,
and organizes them into one cohesive Desktop.</p>
<p>This protocol is conceptually not unlike the Wayland protocol, which allows for the HWC to
be translated into Wayland. This is essentially what the SPURV HWComposer does.</p>
<p>Additionally it deals with input, like touch screen events and passes them along from Wayland
to Android, this however is unrelated to the HWC API.</p>
<h3>SPURV DHCP</h3>
<p>This is a simple DHCP implementation, which serves to enable the Android
network stack to run properly within a container.</p>
<h3>How does it work?</h3>
<p>The SPURV Android target device behaves as a faux Android device, and tailors
the Android build to our requirements.</p>
<p>Functions SPURV performs:</p>
<ul>
<li>Customizes defaults.</li>
<li>Configures network.</li>
<li>Enables an audio bridge from Android to ALSA.</li>
<li>Enables a graphics bridge from Android to Wayland.</li>
</ul>
<h2>How can I use it?</h2>
<p>Full build instructions as can be found on our <a href="https://gitlab.collabora.com/spurv/device_freedesktop/blob/master/spurv/README.md">GitLab</a> for the <a href="https://gitlab.collabora.com/spurv">SPURV project</a>.</p>
<p>An overview of setting up:</p>
<ul>
<li>Fetch Android (AOSP) and the Linux kernel.</li>
<li>Integrate SPURV into Android.</li>
<li>Build Android &amp; Linux Kernel.</li>
<li>Build a debootstrap based root filesystem.</li>
<li>Flash Kernel, Android and root filesystem to the device of your choice.</li>
</ul>
<h2>Caveats</h2>
<p>The way SPURV is implemented means that a full OS is being run in a container,
which has implications both positive and negative.</p>
<p>One of the positive effects is increased isolation of Android applications,
which means improved security and privacy for potentially untrusted applications.</p>
<p>Additionally, this approach allows for Android applications to be run next to
Wayland based applications in a desktop environment.</p>
<p>The downsides relate to hardware access and performance. All hardware access
that is needed by Android has to be passed into the container.
Besides manually having to configure such access using <code>systemd-nspawn</code>,
there are also performance costs associated with running a container.
One part of this is the static cost of having to load an entire OS on top
of the base OS, but there are also additional runtime performance penalties
for applications in the container.</p>
<h2>Acknowledgements</h2>
<ul>
<li>Pengutronix</li>
<li>Kinetic</li>
<li>Zodiac</li>
<li>Boundary Devices</li>
</ul>
<p>This post has been a part of work undertaken by my employer <a href="http://www.collabora.com">Collabora</a>.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/linux.html">linux </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/open-source.html">open source </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/graphics.html">graphics </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/wayland.html">wayland </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/android.html">android </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/3d.html">3d </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/acceleration.html">acceleration </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2019 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>