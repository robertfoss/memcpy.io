<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Running Docker privileged inside of LXC / LXD</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
        <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="memcpy.io atom feed" />
		<link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS feed" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Setup container on LXC Host In order to give Docker in the guest privileges, the guest container itself has to be given privileges. There is no simple switch for doing this in LXC unfortunately, but a few config options will do the trick. lxc launch images:ubuntu/bionic container lxc config set container security.nesting true lxc config set container security.privileged true cat &lt;&lt;EOT | lxc config set container raw.lxc - lxc.cgroup.devices.allow = a lxc.cap.drop = EOT lxc restart container Setup docker on container Just to verify that this works, start a privileged Docker container inside of the LXC container. $ lxc exec container bash $ docker run --privileged hello-world Unable to find image &#39;hello-world:latest&#39; locally latest: Pulling from library/hello-world d1725b59e92d: Pull …">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, linux, virtualization, lxc, lxd, docker, privileges">
		<meta property="og:title" content="Running Docker privileged inside of LXC / LXD" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://memcpy.io/images/2018-12-03_docker.png" />
		<meta property="og:url" content="https://memcpy.io/running-docker-privileged-inside-of-lxc-lxd.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2018-12-03" />
		<meta property="article:section" content="linux" />
		<meta property="article:tag" content="linux" />
		<meta property="article:tag" content="virtualization" />
		<meta property="article:tag" content="lxc" />
		<meta property="article:tag" content="lxd" />
		<meta property="article:tag" content="docker" />
		<meta property="article:tag" content="privileges" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Running Docker privileged inside of LXC / LXD" />
		<meta name="twitter:description" content="Being able to run Docker containers inside of LXC containers comes in quite handy due to them solving slightly different issues." />
		<meta name="twitter:image" content="https://memcpy.io/images/2018-12-03_docker.png" />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Running Docker privileged inside of LXC / LXD</h1>
				<p>
				Published <time datetime="2018-12-03" itemprop="datePublished">2018-12-03</time>
				</p>
			</header>
			<p>Being able to run Docker containers inside of LXC containers comes in quite handy due to them solving slightly different issues.</p>
			<p><a href="/images/2018-12-03_docker.png"><img alt="Alt text" src="/images/2018-12-03_docker.png" title="Docker running inside of LXC">
</a></p>
<h2>Setup container on LXC Host</h2>
<p>In order to give Docker in the guest privileges, the guest container
itself has to be given privileges.</p>
<p>There is no simple switch for doing this in LXC unfortunately, but a few
config options will do the trick.</p>
<div class="highlight"><pre><span></span>lxc launch images:ubuntu/bionic container

lxc config set container security.nesting true
lxc config set container security.privileged true
cat &lt;&lt;EOT | lxc config set container raw.lxc -
lxc.cgroup.devices.allow = a
lxc.cap.drop =
EOT

lxc restart container
</pre></div>


<h2>Setup docker on container</h2>
<p>Just to verify that this works, start a privileged Docker container inside
of the LXC container.</p>
<div class="highlight"><pre><span></span>$ lxc <span class="nb">exec</span> container bash
$ docker run --privileged hello-world
Unable to find image <span class="s1">&#39;hello-world:latest&#39;</span> locally
latest: Pulling from library/hello-world
d1725b59e92d: Pull <span class="nb">complete</span>
Digest: sha256:0add3ace90ecb4adbf7777e9aacf18357296e799f81cabc9fde470971e499788
Status: Downloaded newer image <span class="k">for</span> hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
<span class="m">1</span>. The Docker client contacted the Docker daemon.
<span class="m">2</span>. The Docker daemon pulled the <span class="s2">&quot;hello-world&quot;</span> image from the Docker Hub.
<span class="o">(</span>amd64<span class="o">)</span>
<span class="m">3</span>. The Docker daemon created a new container from that image which runs the
executable that produces the output you are currently reading.
<span class="m">4</span>. The Docker daemon streamed that output to the Docker client, which sent it
to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
https://hub.docker.com/

For more examples and ideas, visit:
https://docs.docker.com/get-started/
</pre></div>


<h2>Thanks</h2>
<p>This write-up is based <a href="https://github.com/lxc/lxd/issues/4902">info</a> provided
by Stéphane Graber.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="./tag/linux.html">linux </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/virtualization.html">virtualization </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/lxc.html">lxc </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/lxd.html">lxd </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/docker.html">docker </a>
					<span id="breakdot">&middot; </span>
					<a href="./tag/privileges.html">privileges </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2018 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>