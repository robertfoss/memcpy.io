<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="./theme/css/style.css">
	<!--<link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">-->
	<!--<script src="/theme/js/less.js" type="text/javascript"></script>-->
	<link rel="stylesheet" type="text/css" href="./theme/css/pygments.css">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link rel="icon" type="image/png" href="favicon.png" />

	<link href="http://memcpy.io/" type="application/atom+xml" rel="alternate" title="memcpy.io ATOM Feed" />

    <meta property="og:title" content="Running Weston on a Raspbian" />
    <meta property="og:type" content="article" />
    <meta property="og:image" content="http://memcpy.io/images/2016-06-03_weston.png" />
    <meta property="og:url" content="http://memcpy.io/running-weston-on-a-raspbian.html" />
    <meta property="og:description" content="Progress in the VC4 graphics camp and the Wayland camp now enables us to run Weston on top of the drm backend for VC4 platforms. Previously software acceleration using pixman was needed, but this is no longer the case. Additionally the rpi backend for weston is now being removed since ..." />
    <meta property="og:locale" content="" />
    <meta property="og:site_name" content="memcpy.io" />
    <meta property="article:published_time" content="2016-06-03" />
    <meta property="article:section" content="wayland" />
    <meta property="article:tag" content="wayland" />
    <meta property="article:tag" content="weston" />
    <meta property="article:tag" content="rpi" />
    <meta property="article:tag" content="rpi2" />
    <meta property="article:tag" content="kernel" />

	<title>memcpy.io</title>
	<meta charset="utf-8" />
</head>
<body>
	<section id="sidebar">
		<div id="menu">
			<a href="/">
				<img type="image/png" src="./logo.png" width="155">
			</a>

			<h2>Projects, hacks and engineering</h2>
			<ul>
					<li><a href="about-me.html">About me</a></li>
					<li><a href="contracting.html">Contracting</a></li>
					<li><a href="https://github.com/robertfoss">GitHub</a></li>
					<li><a href="archives.html">Previous posts</a></li>
			</ul>
		</div>
	</section>

	<section id="posts">
	<article class="single">
		<h1 id="title">
			<a href="./running-weston-on-a-raspbian.html" rel="bookmark"
				title="Permalink to Running Weston on a Raspbian">Running Weston on a Raspbian</a>
		</h1>
		<abbr class="published" title="2016-06-03T10:32:00+02:00">Fri 03 June 2016</abbr>
		<p><img alt="Alt text" src="images/2016-06-03_weston.png" title="Weston running on a RPi2." /></p>
<p>Progress in the VC4 graphics camp and the Wayland camp now enables us to run
Weston on top of the drm backend for VC4 platforms. Previously software acceleration
using pixman was needed, but this is no longer the case.</p>
<p>Additionally the rpi backend for weston is now being removed since it has been
obsoleted by the improved drm layer.</p>
<p>Let's explore running hardware accelerated Weston on the Raspberry Pi.</p>
<h2>Building Linux kernel</h2>
<p>A comprehensive guide for building a recent Linux kernel for Raspberry Pi boards has
been written by the Raspberry Pi foundation and is available <a href="https://www.raspberrypi.org/documentation/linux/kernel/building.md">here</a>.</p>
<p>As of this writing the guide helps you build a v4.4 kernel which is good enough for our purposes.</p>
<h2>Set up alternative install location</h2>
<p>These build instructions are based on the <a href="https://wayland.freedesktop.org/building.html">Wayland instructions</a>
from freedesktop.org, but altered to target VC4 and Raspbian.</p>
<p>You probably don't want to install experimental builds of software among the usual
software of your operating system, so let's define a prefix for where to install
our builds.</p>
<div class="highlight"><pre><span class="err">#</span><span class="x"> Change WLD any location you like</span>
<span class="x">export WLD=/opt/local</span>
<span class="x">export LD_LIBRARY_PATH=</span><span class="p">$</span><span class="nv">WLD</span><span class="x">/lib</span>
<span class="x">export PKG_CONFIG_PATH=</span><span class="p">$</span><span class="nv">WLD</span><span class="x">/lib/pkgconfig/:</span><span class="p">$</span><span class="nv">WLD</span><span class="x">/share/pkgconfig/</span>
<span class="x">export PATH=</span><span class="p">$</span><span class="nv">WLD</span><span class="x">/bin:</span><span class="p">$</span><span class="nv">PATH</span><span class="x"></span>
<span class="x">export ACLOCAL_PATH=</span><span class="p">$</span><span class="nv">WLD</span><span class="x">/share/aclocal</span>
<span class="x">export ACLOCAL=&quot;aclocal -I </span><span class="p">$</span><span class="nv">ACLOCAL_PATH</span><span class="x">&quot;</span>

<span class="err">#</span><span class="x"> Needed by autotools</span>
<span class="x">mkdir -p </span><span class="p">$</span><span class="nv">WLD</span><span class="x">/share/aclocal</span>
</pre></div>


<h2>Installing dependencies</h2>
<p>Start by installing the build dependencies of mesa, weston and wayland.</p>
<div class="highlight"><pre># Enable source packages
sudo sed -e &quot;s/#\sdeb-src/deb-src/g&quot; -i /etc/apt/sources.list
sudo apt update
</pre></div>


<p>The above step can alternatively be completed using the GUI of your
package manager, by enabling source packages.</p>
<div class="highlight"><pre># Install build dependencies of mesa
sudo apt-get build-dep mesa

# Install build dependencies of wayland/weston
sudo apt-get install \
  libunwind libunwind-dev \
  libevdev libevdev-dev \
  libwacom libwacom-dev \
  libxkbcommon libxkbcommon-dev
</pre></div>


<h2>Building Mesa</h2>
<p>Configure and compile mesa with vc4, wayland and EGL support.</p>
<div class="highlight"><pre><span class="x">git clone git://anongit.freedesktop.org/mesa/mesa</span>
<span class="x">cd mesa</span>
<span class="x">./autogen.sh --prefix=</span><span class="p">$</span><span class="nv">WLD</span><span class="x"> --enable-gles2 \</span>
<span class="x">  --with-egl-platforms=x11,wayland,drm --enable-gbm --enable-shared-glapi \</span>
<span class="x">  --with-gallium-drivers=vc4</span>
<span class="x">make -j4 &amp;&amp; make install</span>
</pre></div>


<h2>Building Weston and dependencies</h2>
<p>Weston and Wayland have a number of dependencies that also need to be fetched
and built.</p>
<h4>Wayland</h4>
<p>Weston is a Wayland compositor, so we're going to have to build Wayland.</p>
<div class="highlight"><pre><span class="x">git clone git://anongit.freedesktop.org/wayland/wayland</span>
<span class="x">cd wayland</span>
<span class="x">./autogen.sh --prefix=</span><span class="p">$</span><span class="nv">WLD</span><span class="x"></span>
<span class="x">make -j4 &amp;&amp; make install</span>
<span class="x">cd ..</span>

<span class="x">git clone git://anongit.freedesktop.org/wayland/wayland-protocols</span>
<span class="x">cd wayland-protocols</span>
<span class="x">./autogen.sh --prefix=</span><span class="p">$</span><span class="nv">WLD</span><span class="x"></span>
<span class="x">make install</span>
<span class="x">cd ..</span>
</pre></div>


<h4>libinput</h4>
<p>libinput is dependency of wasten,  handles input devices like keyboards, touchpads and mice.</p>
<div class="highlight"><pre><span class="x">git clone git://anongit.freedesktop.org/wayland/libinput</span>
<span class="x">cd libinput</span>
<span class="x">./autogen.sh --prefix=</span><span class="p">$</span><span class="nv">WLD</span><span class="x"></span>
<span class="x">make -j4 &amp;&amp; make install</span>
<span class="x">cd ..</span>
</pre></div>


<h4>Weston</h4>
<p>Finally we've built all of the dependencies of Weston and can now build it.</p>
<div class="highlight"><pre><span class="x">git clone git://anongit.freedesktop.org/wayland/weston</span>
<span class="x">cd weston</span>
<span class="x">./autogen.sh --prefix=</span><span class="p">$</span><span class="nv">WLD</span><span class="x"></span>
<span class="x">make -j4</span>
<span class="x">sudo make install</span>
<span class="x">cd ..</span>
</pre></div>


<h2>Running Weston</h2>
<p>That wasn't so bad, it took a little while, but now we're ready to start Weston.</p>
<div class="highlight"><pre># Run as root
sudo su

# Set up environment variables to access our newly built binaries
export WLD=/opt/local
export LD_LIBRARY_PATH=<span class="nv">$WLD</span>/libs
export PATH=<span class="nv">$WLD</span>/bin:<span class="nv">$PATH</span>

# Make sure that <span class="nv">$DISPLAY</span> is unset.
unset DISPLAY

# And that <span class="nv">$XDG_RUNTIME_DIR</span> has been set and created.
export XDG_RUNTIME_DIR=/tmp/xdg-runtime-dir
mkdir &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;
chmod 0700 &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;

# Run weston:
weston

# Run weston through ssh:
# If running weston through ssh, make sure an input device is attached.
weston --tty=3
</pre></div>


<h2>Try weston applications</h2>
<p>Now that we're running weston, let's try some applications.</p>
<ul>
<li>weston-terminal</li>
<li>weston-flower</li>
<li>weston-gears</li>
<li>weston-smoke</li>
<li>weston-image</li>
<li>weston-view</li>
<li>weston-resizor</li>
<li>weston-eventdemo</li>
</ul>
<p>When you've started all of your favorite applications you can grab a screenshot 
by pressing <strong>Super + s</strong>, which will save wayland-screenshot.png in your home
directory.</p>

		<div id="article_meta">
				Category:
					<a href="./category/wayland.html">wayland</a>
				<br />Tags:
					<a href="./tag/wayland.html">wayland</a>
					<a href="./tag/weston.html">weston</a>
					<a href="./tag/rpi.html">rpi</a>
					<a href="./tag/rpi2.html">rpi2</a>
					<a href="./tag/kernel.html">kernel</a>
		</div>
	</article>

	<footer>
		<a href="./" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
	</footer>


	</section>

</body>
</html>