<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Running Weston on a Raspbian</title>
		<link rel="icon" type="image/png" href="/logo.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
		<link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="canonical" href="https://memcpy.io/running-weston-on-a-raspbian.html">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="Progress in the VC4 graphics camp and the Wayland camp now enables us to run Weston on top of the drm backend for VC4 platforms. Previously software acceleration using pixman was needed, but this is no longer the case. Additionally the rpi backend for weston is now being removed since it has been obsoleted by the improved drm layer. Let&#39;s explore running hardware accelerated Weston on the Raspberry Pi. Building Linux kernel A comprehensive guide for building a recent Linux kernel for Raspberry Pi boards has been written by the Raspberry Pi foundation and is available here. As of this writing the guide helps you build a v4.4 kernel which is good enough for our purposes. Set up alternative install location These build instructions â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Embedded, Engineer, wayland, weston, rpi, rpi2, kernel">
		<meta property="og:title" content="Running Weston on a Raspbian" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://memcpy.io/images/2016-06-03_weston.png" />
		<meta property="og:url" content="https://memcpy.io/running-weston-on-a-raspbian.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2016-06-03" />
		<meta property="article:section" content="wayland" />
		<meta property="article:tag" content="wayland" />
		<meta property="article:tag" content="weston" />
		<meta property="article:tag" content="rpi" />
		<meta property="article:tag" content="rpi2" />
		<meta property="article:tag" content="kernel" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Running Weston on a Raspbian" />
		<meta name="twitter:description" content="This is a simple guide for how to build and run Wayland &amp; Weston on a Raspberry Pi." />
		<meta name="twitter:image" content="https://memcpy.io/images/2016-06-03_weston.png" />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Running Weston on a Raspbian</h1>
				<p>
				Published <time datetime="2016-06-03" itemprop="datePublished">2016-06-03</time>
				</p>
			</header>
			<p>This is a simple guide for how to build and run Wayland & Weston on a Raspberry Pi.</p>
			<p><img alt="Alt text" src="/images/2016-06-03_weston.png" title="Weston running on a RPi2."></p>
<p>Progress in the VC4 graphics camp and the Wayland camp now enables us to run
Weston on top of the drm backend for VC4 platforms. Previously software acceleration
using pixman was needed, but this is no longer the case.</p>
<p>Additionally the rpi backend for weston is now being removed since it has been
obsoleted by the improved drm layer.</p>
<p>Let's explore running hardware accelerated Weston on the Raspberry Pi.</p>
<h2>Building Linux kernel</h2>
<p>A comprehensive guide for building a recent Linux kernel for Raspberry Pi boards has
been written by the Raspberry Pi foundation and is available <a href="https://www.raspberrypi.org/documentation/linux/kernel/building.md">here</a>.</p>
<p>As of this writing the guide helps you build a v4.4 kernel which is good enough for our purposes.</p>
<h2>Set up alternative install location</h2>
<p>These build instructions are based on the <a href="https://wayland.freedesktop.org/building.html">Wayland instructions</a>
from freedesktop.org, but altered to target VC4 and Raspbian.</p>
<p>You probably don't want to install experimental builds of software among the usual
software of your operating system, so let's define a prefix for where to install
our builds.</p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">Change</span> <span class="n">WLD</span> <span class="k">to</span> <span class="k">any</span> <span class="k">location</span> <span class="n">you</span> <span class="k">like</span>
<span class="n">export</span> <span class="n">WLD</span><span class="o">=~/</span><span class="k">local</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="n">lib</span>
<span class="n">export</span> <span class="n">PKG_CONFIG_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="p">:</span><span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">ACLOCAL_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">aclocal</span>
<span class="n">export</span> <span class="n">ACLOCAL</span><span class="o">=</span><span class="ss">&quot;aclocal -I $ACLOCAL_PATH&quot;</span>

<span class="o">#</span> <span class="n">Needed</span> <span class="k">by</span> <span class="n">autotools</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">WLD</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">aclocal</span>
</code></pre></div>

<h2>Installing dependencies</h2>
<p>Start by installing the build dependencies of mesa, weston and wayland.</p>
<div class="highlight"><pre><span></span><code><span class="err"># Enable source packages</span>
<span class="err">sudo sed -e &quot;s/#\sdeb-src/deb-src/g&quot; -i /etc/apt/sources.list</span>
<span class="err">sudo apt update</span>
</code></pre></div>

<p>The above step can alternatively be completed using the GUI of your
package manager, by enabling source packages.</p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">Install</span> <span class="n">build</span> <span class="n">dependencies</span> <span class="k">of</span> <span class="n">mesa</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">build</span><span class="o">-</span><span class="n">dep</span> <span class="n">mesa</span>

<span class="o">#</span> <span class="n">Install</span> <span class="n">build</span> <span class="n">dependencies</span> <span class="k">of</span> <span class="n">wayland</span><span class="o">/</span><span class="n">weston</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="err">\</span>
  <span class="n">libevdev</span> <span class="n">libevdev</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>
  <span class="n">libwacom</span> <span class="n">libwacom</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>
  <span class="n">libxkbcommon</span> <span class="n">libxkbcommon</span><span class="o">-</span><span class="n">dev</span>
</code></pre></div>

<h2>Building Mesa</h2>
<p>Configure and compile mesa with vc4, wayland and EGL support.</p>
<div class="highlight"><pre><span></span><code><span class="err">git clone git://anongit.freedesktop.org/mesa/mesa</span>
<span class="err">cd mesa</span>
<span class="err">./autogen.sh --prefix=$WLD \</span>
<span class="err">  --enable-gles2 \</span>
<span class="err">  --with-egl-platforms=x11,wayland,drm \</span>
<span class="err">  --enable-gbm --enable-shared-glapi \</span>
<span class="err">  --with-gallium-drivers=vc4 \</span>
<span class="err">  --without-dri-drivers \</span>
<span class="err">  --disable-va \</span>
<span class="err">  --disable-vdpau \</span>
<span class="err">  --disable-xvmc \</span>
<span class="err">  --disable-omx</span>
<span class="err">make -j4 &amp;&amp; make install</span>
</code></pre></div>

<h2>Building Weston and dependencies</h2>
<p>Weston and Wayland have a number of dependencies that also need to be fetched
and built.</p>
<h4>Wayland</h4>
<p>Weston is a Wayland compositor, so we're going to have to build Wayland.</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">anongit</span><span class="p">.</span><span class="n">freedesktop</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">wayland</span><span class="o">/</span><span class="n">wayland</span>
<span class="n">cd</span> <span class="n">wayland</span>
<span class="p">.</span><span class="o">/</span><span class="n">autogen</span><span class="p">.</span><span class="n">sh</span> <span class="c1">--prefix=$WLD</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j4</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>
<span class="n">cd</span> <span class="p">..</span>

<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">anongit</span><span class="p">.</span><span class="n">freedesktop</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">wayland</span><span class="o">/</span><span class="n">wayland</span><span class="o">-</span><span class="n">protocols</span>
<span class="n">cd</span> <span class="n">wayland</span><span class="o">-</span><span class="n">protocols</span>
<span class="p">.</span><span class="o">/</span><span class="n">autogen</span><span class="p">.</span><span class="n">sh</span> <span class="c1">--prefix=$WLD</span>
<span class="n">make</span> <span class="n">install</span>
<span class="n">cd</span> <span class="p">..</span>
</code></pre></div>

<h4>libinput</h4>
<p>libinput is a dependency of Weston, handles input devices like keyboards, touchpads and mice.</p>
<div class="highlight"><pre><span></span><code><span class="err">git clone git://anongit.freedesktop.org/wayland/libinput</span>
<span class="err">cd libinput</span>
<span class="err">./autogen.sh --prefix=$WLD</span>
<span class="err">make -j4 &amp;&amp; make install</span>
<span class="err">cd ..</span>
</code></pre></div>

<h4>Weston</h4>
<p>Finally we've built all of the dependencies of Weston and can now build it.</p>
<div class="highlight"><pre><span></span><code><span class="err">git clone git://anongit.freedesktop.org/wayland/weston</span>
<span class="err">cd weston</span>
<span class="err">./autogen.sh --prefix=$WLD \</span>
<span class="err">  --disable-libunwind</span>
<span class="err">make -j4 &amp;&amp;</span>
<span class="err">sudo make install</span>
<span class="err">cd ..</span>
</code></pre></div>

<h2>Running Weston</h2>
<p>That wasn't so bad, it took a little while, but now we're ready to start Weston.
Now, let's fire up a (virtual) terminal. Make sure that you're not running an
X terminal, ssh terminal or serial terminal.</p>
<p>Running weston in this way depends on logind.</p>
<div class="highlight"><pre><span></span><code># Make sure that <span class="nv">$DISPLAY</span> is unset.
unset DISPLAY

# And that <span class="nv">$XDG_RUNTIME_DIR</span> has been set and created.
if test -z &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;; then
  export XDG_RUNTIME_DIR=/tmp/<span class="cp">${</span><span class="n">UID</span><span class="cp">}</span>-runtime-dir
  if ! test -d &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;; then
    mkdir &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;
    chmod 0700 &quot;<span class="cp">${</span><span class="n">XDG_RUNTIME_DIR</span><span class="cp">}</span>&quot;1
  fi
fi

# Run weston:
weston
</code></pre></div>

<h2>Try weston applications</h2>
<p>Now that we're running weston, let's try some applications.
They're located in the top level directory of weston.</p>
<ul>
<li>weston-terminal</li>
<li>weston-flower</li>
<li>weston-gears</li>
<li>weston-smoke</li>
<li>weston-image</li>
<li>weston-view</li>
<li>weston-resizor</li>
<li>weston-eventdemo</li>
</ul>
<p>When you've started all of your favorite applications you can grab a screenshot 
by pressing <strong>Super + s</strong>, which will save wayland-screenshot.png in your home
directory.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="https://memcpy.io/tag/wayland.html">wayland </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/weston.html">weston </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/rpi.html">rpi </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/rpi2.html">rpi2 </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/kernel.html">kernel </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2021 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.png"></a>
				</p>
			</div>
		</footer>
	</body>
</html>