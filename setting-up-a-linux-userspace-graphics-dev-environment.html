<!DOCTYPE html>
<html>
	<head>
		<title>memcpy.io | Setting up a Linux userspace graphics dev environment</title>
		<script src="https://cdn.nocodeflow.net/tools/geoblock.js"></script>
		<link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="stylesheet" type="text/css" href="/theme/css/fonts.css">
		<link rel="stylesheet" type="text/css" href="/theme/css/math.css">
		<link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
		<link rel="canonical" href="https://memcpy.io/setting-up-a-linux-userspace-graphics-dev-environment.html">
		<link rel="stylesheet" type="text/css" href="/theme/css/page.css">
		<link href="https://memcpy.io/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="memcpy.io ATOM Feed" />
		<link href="https://memcpy.io/feeds/all.atom.xml" type="application/rss+xml" rel="alternate" title="memcpy.io RSS Feed" />
		<meta name="google-site-verification" content="M7TRHJxGB04WWoywNbib8VC7rcbyjs7aMI2Bnkh6XqA" />
		<meta charset="utf-8">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- TODO: is this still required in 2015? -->
		<meta name="description" content="![Alt text](/images/2016-06-03_weston.png &#34;Weston running on a RPi2.&#34;) Progress in the VC4 graphics camp and the Wayland camp now enables us to run Weston on top of the drm backend for VC4 platforms. Previously software acceleration using pixman was needed, but this is no longer the case. Additionally the rpi backend for weston is now being removed since it has been obsoleted by the improved drm layer. Let&#39;s explore running hardware accelerated Weston on the Raspberry Pi. Building Linux kernel A comprehensive guide for building a recent Linux kernel for Raspberry Pi boards has been written by the Raspberry Pi foundation and is available [here](https://www.raspberrypi.org/documentation/linux/kernel/building.md). As of this writing the guide â€¦">
		<meta name="author" content="Robert Foss">
		<meta name="keywords" content="Robert Foss memcpy Robert Foss, Open Source, Software, Linux, Kernel, Embedded, Engineer, xwayland, wayland, mesa, graphics, userspace">
		<meta property="og:title" content="Setting up a Linux userspace graphics dev environment" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://memcpy.io/setting-up-a-linux-userspace-graphics-dev-environment.html" />
		<meta property="og:locale" content="" />
		<meta property="og:site_name" content="memcpy.io" />
		<meta property="article:published_time" content="2023-04-26" />
		<meta property="article:section" content="graphics" />
		<meta property="article:tag" content="xwayland" />
		<meta property="article:tag" content="wayland" />
		<meta property="article:tag" content="mesa" />
		<meta property="article:tag" content="graphics" />
		<meta property="article:tag" content="userspace" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@memcpy_io" />
		<meta name="twitter:site" content="@memcpy_io" />
		<meta name="twitter:title" content="Setting up a Linux userspace graphics dev environment" />
		<meta name="twitter:description" content="This is a simple guide for how to build and run Wayland &amp; Weston on a Raspberry Pi." />
	</head>
	<body>
		<article id="content" itemscope>
			<header>
				<h1>Setting up a Linux userspace graphics dev environment</h1>
				<p>
				Published <time datetime="2023-04-26" itemprop="datePublished">2023-04-26</time>
				</p>
			</header>
			<p>This is a simple guide for how to build and run Wayland & Weston on a Raspberry Pi.</p>
			<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="o">!</span><span class="p">[</span><span class="n">Alt</span><span class="w"> </span><span class="n">text</span><span class="p">](</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="mi">2016</span><span class="mo">-06-03</span><span class="n">_weston</span><span class="p">.</span><span class="n">png</span><span class="w"> </span><span class="s">&quot;Weston running on a RPi2.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">Progress</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VC4</span><span class="w"> </span><span class="n">graphics</span><span class="w"> </span><span class="n">camp</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Wayland</span><span class="w"> </span><span class="n">camp</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">enables</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span>
<span class="w">    </span><span class="n">Weston</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">drm</span><span class="w"> </span><span class="n">backend</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">VC4</span><span class="w"> </span><span class="n">platforms</span><span class="p">.</span><span class="w"> </span><span class="n">Previously</span><span class="w"> </span><span class="n">software</span><span class="w"> </span><span class="n">acceleration</span>
<span class="w">    </span><span class="n">using</span><span class="w"> </span><span class="n">pixman</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">needed</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="p">.</span>

<span class="w">    </span><span class="no">Additionally</span><span class="w"> </span><span class="no">the</span><span class="w"> </span><span class="no">rpi</span><span class="w"> </span><span class="no">backend</span><span class="w"> </span><span class="no">for</span><span class="w"> </span><span class="no">weston</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">now</span><span class="w"> </span><span class="no">being</span><span class="w"> </span><span class="no">removed</span><span class="w"> </span><span class="no">since</span><span class="w"> </span><span class="no">it</span><span class="w"> </span><span class="no">has</span><span class="w"> </span><span class="no">been</span>
<span class="w">    </span><span class="no">obsoleted</span><span class="w"> </span><span class="no">by</span><span class="w"> </span><span class="no">the</span><span class="w"> </span><span class="no">improved</span><span class="w"> </span><span class="no">drm</span><span class="w"> </span><span class="no">layer</span><span class="p">.</span>

<span class="w">    </span><span class="no">Let</span><span class="err">&#39;</span><span class="no">s</span><span class="w"> </span><span class="no">explore</span><span class="w"> </span><span class="no">running</span><span class="w"> </span><span class="no">hardware</span><span class="w"> </span><span class="no">accelerated</span><span class="w"> </span><span class="no">Weston</span><span class="w"> </span><span class="no">on</span><span class="w"> </span><span class="no">the</span><span class="w"> </span><span class="no">Raspberry</span><span class="w"> </span><span class="no">Pi</span><span class="p">.</span>
</code></pre></div>

<h2>Building Linux kernel</h2>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="n">comprehensive</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">building</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Raspberry</span><span class="w"> </span><span class="nf">Pi</span><span class="w"> </span><span class="n">boards</span><span class="w"> </span><span class="n">has</span>
<span class="w">    </span><span class="n">been</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Raspberry</span><span class="w"> </span><span class="nf">Pi</span><span class="w"> </span><span class="n">foundation</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="o">[</span><span class="n">here</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">raspberrypi</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">documentation</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">building</span><span class="p">.</span><span class="n">md</span><span class="p">).</span>

<span class="w">    </span><span class="k">As</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="n">helps</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">v4</span><span class="mf">.4</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">purposes</span><span class="p">.</span>
</code></pre></div>

<h2>Set up alternative install location</h2>
<p>These build instructions are based on the <a href="https://wayland.freedesktop.org/building.html">Wayland instructions</a>
from freedesktop.org, but altered to target VC4 and Raspbian.</p>
<p>You probably don't want to install experimental builds of software among the usual
software of your operating system, so let's define a prefix for where to install
our builds.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change ALT_LOCAL to any location you like</span>
<span class="k">export</span><span class="w"> </span><span class="n">WORK_DIR</span><span class="o">=</span><span class="s2">&quot;/opt&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">PROJECT_NAME</span><span class="o">=</span><span class="s2">&quot;feature_x&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">PROJECT_PATH</span><span class="o">=</span><span class="s2">&quot;$WORK_DIR/$PROJECT_NAME&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">ALT_LOCAL</span><span class="o">=</span><span class="s2">&quot;$PROJECT_PATH/local&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/lib&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">PKG_CONFIG_PATH</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/lib/pkgconfig/:$ALT_LOCAL/share/pkgconfig/&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/bin:$PATH&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">ACLOCAL_PATH</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/share/aclocal&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">ACLOCAL</span><span class="o">=</span><span class="s2">&quot;aclocal -I $ACLOCAL_PATH&quot;</span>

<span class="c1"># Needed by autotools</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="s2">&quot;$ALT_LOCAL/share/aclocal&quot;</span>

<span class="k">export</span><span class="w"> </span><span class="n">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/xdg&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">XDG_CONFIG_HOME</span><span class="o">=</span><span class="s2">&quot;$ALT_LOCAL/home&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">MESA_LOADER_DRIVER_OVERRIDE</span><span class="o">=</span><span class="n">zink</span>
</code></pre></div>

<h2>Installing dependencies</h2>
<p>Start by installing the build dependencies of mesa, weston and wayland.</p>
<div class="highlight"><pre><span></span><code># Enable source packages
sudo sed -e &quot;s/#\sdeb-src/deb-src/g&quot; -i /etc/apt/sources.list
sudo apt update
</code></pre></div>

<p>The above step can alternatively be completed using the GUI of your
package manager, by enabling source packages.</p>
<div class="highlight"><pre><span></span><code># Install build dependencies of mesa
sudo apt build-dep gtk3 gtk4 libinp/opt/zink/local/home/weston.iniut mesa wayland weston xserver

sudo apt install xcb-util-cursor-dev

# Install a recent version of meson
pip3 install --user meson
</code></pre></div>

<h2>Building Wayland</h2>
<div class="highlight"><pre><span></span><code>git clone https://gitlab.freedesktop.org/wayland/wayland.git \
cd wayland \
meson build/ --prefix=&quot;$ALT_LOCAL&quot; \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>Building Wayland Protocols</h2>
<div class="highlight"><pre><span></span><code>git clone https://gitlab.freedesktop.org/wayland/wayland-protocols.git \
cd wayland-protocols \
meson build/ --prefix=&quot;$ALT_LOCAL&quot; \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>libglvnd OpenGL Vendor-Neutral Dispatch library</h2>
<div class="highlight"><pre><span></span><code>git clone https://github.com/NVIDIA/libglvnd.git \
cd libglvnd \
meson setup build/ --prefix=&quot;$ALT_LOCAL&quot; \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>libinput</h2>
<p>libinput is a dependency of Weston, handles input devices like keyboards, touchpads and mice.</p>
<div class="highlight"><pre><span></span><code>git clone https://gitlab.freedesktop.org/libinput/libinput \
cd libinput \
meson setup build/ --prefix=&quot;$ALT_LOCAL&quot; \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>Building Mesa</h2>
<p>This build is targeting using swrast for Vulkan and Zink for OpenGL support.</p>
<div class="highlight"><pre><span></span><code>git clone https://gitlab.freedesktop.org/mesa/mesa.git \
cd mesa
meson setup build/ -Dprefix=&quot;$ALT_LOCAL&quot; \
  -Degl=x11,wayland,drm \
  -Degl=enabled \
  -Dgallium-drivers=swrast,zink,r600 \
ninja -C build/ install

# On some systems the lib paths need to be symlinked
ln -s &quot;$ALT_LOCAL/lib64&quot; &quot;$ALT_LOCAL/lib&quot;
</code></pre></div>

<h2>Weston</h2>
<p>Finally we've built all of the dependencies of Weston and can now build it.</p>
<div class="highlight"><pre><span></span><code>git clone git://anongit.freedesktop.org/wayland/weston \
cd weston \
meson setup build/ --prefix=&quot;$ALT_LOCAL&quot; \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>x server</h2>
<div class="highlight"><pre><span></span><code>git clone git://git.freedesktop.org/git/xorg/xserver \
cd xserver \
meson setup build/ -Dprefix=&quot;$ALT_LOCAL&quot; \
  -Dxkb_bin_dir=/usr/bin \
ninja -C build/ install \
cd ..
</code></pre></div>

<h2>Running Weston</h2>
<p>That wasn't so bad, it took a little while, but now we're ready to start Weston.
Now, let's fire up a (virtual) terminal. Make sure that you're not running an
X terminal, ssh terminal or serial terminal.</p>
<div class="highlight"><pre><span></span><code><span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">$</span><span class="n">XDG_RUNTIME_DIR</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">$</span><span class="n">XDG_CONFIG_HOME</span><span class="o">/.</span><span class="n">config</span>
<span class="n">cp</span><span class="w"> </span><span class="o">$</span><span class="n">PROJECT_PATH</span><span class="o">/</span><span class="n">weston</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">compositor</span><span class="o">/</span><span class="n">weston</span><span class="o">.</span><span class="n">ini</span><span class="w"> </span><span class="o">$</span><span class="n">XDG_CONFIG_HOME</span><span class="o">/</span>
<span class="k">export</span><span class="w"> </span><span class="n">WESTON_CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;$XDG_CONFIG_HOME/.config/weston.ini&quot;</span>
<span class="n">chmod</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"> </span><span class="mi">0700</span><span class="w"> </span><span class="o">$</span><span class="n">XDG_RUNTIME_DIR</span>
<span class="n">chmod</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"> </span><span class="mi">0700</span><span class="w"> </span><span class="o">$</span><span class="n">XDG_CONFIG_HOME</span>



<span class="c1"># Make sure that $DISPLAY is unset.</span>
<span class="n">unset</span><span class="w"> </span><span class="n">DISPLAY</span>

<span class="c1"># And that $XDG_RUNTIME_DIR has been set and created.</span>
<span class="k">if</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="w"> </span><span class="s2">&quot;${XDG_RUNTIME_DIR}&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">then</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="n">XDG_RUNTIME_DIR</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/$</span><span class="p">{</span><span class="n">UID</span><span class="p">}</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">dir</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="s2">&quot;${XDG_RUNTIME_DIR}&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">then</span>
<span class="w">    </span><span class="n">mkdir</span><span class="w"> </span><span class="s2">&quot;${XDG_RUNTIME_DIR}&quot;</span>
<span class="w">    </span><span class="n">chmod</span><span class="w"> </span><span class="mi">0700</span><span class="w"> </span><span class="s2">&quot;${XDG_RUNTIME_DIR}&quot;</span>
<span class="w">  </span><span class="n">fi</span>
<span class="n">fi</span>

<span class="c1"># Run weston:</span>
<span class="n">weston</span>
</code></pre></div>

<h2>Try weston applications</h2>
<p>Now that we're running weston, let's try some applications.
They're located in the top level directory of weston.</p>
<ul>
<li>weston-terminal</li>
<li>weston-flower</li>
<li>weston-gears</li>
<li>weston-smoke</li>
<li>weston-image</li>
<li>weston-view</li>
<li>weston-resizor</li>
<li>weston-eventdemo</li>
</ul>
<p>When you've started all of your favorite applications you can grab a screenshot 
by pressing <strong>Super + s</strong>, which will save wayland-screenshot.png in your home
directory.</p>
		</article>
		<section id="teaser-section">
			<div id="teaser">
				<p>Tags:
					<a href="https://memcpy.io/tag/xwayland.html">xwayland </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/wayland.html">wayland </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/mesa.html">mesa </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/graphics.html">graphics </a>
					<span id="breakdot">&middot; </span>
					<a href="https://memcpy.io/tag/userspace.html">userspace </a>
				</p>
			</div>
		</section>
		<footer>
			<div id="footer">
				<p id="notices" class="smcp">
					<a href="/about.html">About</a>
					<span id="breakdot">&middot;</span>
					<a href="/index.html">Blog</a>
					<span id="breakdot">&middot;</span>
					<a href="/talks.html">Talks</a>
					<span id="breakdot">&middot;</span>
					<a href="/contact.html">Contact</a>
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss">GitHub</a>
					<br>
					<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Copyleft</a>
					<span id="breakdot">&middot;</span>
					2023 Robert Foss
					<span id="breakdot">&middot;</span>
					<a href="https://github.com/robertfoss/memcpy.io">Source</a>
					<br>
					<a href="/"><img src="/logo.svg"></a>
				</p>
			</div>
		</footer>
	</body>
</html>